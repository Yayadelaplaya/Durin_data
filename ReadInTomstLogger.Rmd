---
title: "DC.1 DURIN TOMST Logger Data Cleaning"
author: "OUDINA Yanis"
date: "05/06/2023"
output: html_notebook
---

To start, you should simply install all the packages requiered to run the code.
```{r install_packages}
install.packages("tidyverse")
install.packages("lubridate")
install.packages("dataDownloader")
install.packages("purrrlyr")
install.packages("readxl")
install.packages("fs")
install.packages("purrr")
install.packages("readr")
install.packages("ggplot2")
install.packages("lme4")
install.packages("stargazer")
```

And to load them.

```{r load_packages}

source("https://raw.githubusercontent.com/audhalbritter/Three-D/master/R/Climate/soilmoisture_correction.R")
library(tidyverse)
library(lubridate)
# library(dataDownloader)
library(purrrlyr)
library(readxl)
library(fs)
library(purrr)
library(readr)
library(ggplot2)
library(lme4)
library(stargazer)
library(emmeans)
library(see)
library(svglite)
library(officer)
library(lmerTest)
library(officer)
source("soilmoisture_correction.R")
```

This section is the one importing the data: metadata & loggers data.
You may have to change this depending on where your data are. You can also import them directly from OSF if the "Datadownloader" package is working.

It also makes small changes on the data naming/format.

```{r import_data}

# Read in meta data
metatomst <- read_excel(path="durin_tomst_microclimate_loggers_metadata.xlsx", col_names=TRUE, col_types=c("text","text","numeric","text","text","numeric","text","text","numeric","numeric","date","date","numeric","text","numeric","text","numeric","text","numeric","text","text"))#

# Change formats
# Date format to day/month/year in 01/12/1990 format
# PlotID and LoggerID to factor to match later scripts$
metatomst$date_in <- format(metatomst$date_in, "%d/%m/%Y")
metatomst$date_out <- format(metatomst$date_out, "%d/%m/%Y")
metatomst$loggerID <- as.factor(metatomst$loggerID)
metatomst$plotID <- as.factor(as.numeric(metatomst$plotID))
# Check loggerID and plotID's as they don't seem to stay correct format.
#unique(metatomst$loggerID) # Should be 116
#unique(metatomst$plotID) # Should be 1.1, 1.2, 1.3 >> 9.1, 9.2, 9.3 for 27 unique values

### Read in files
files <- dir(path = "data/loggers_data/not_drought", pattern = "^data.*\\.csv$", full.names = TRUE, recursive = TRUE)

temp_raw <- map_df(set_names(files), function(file) {
  file %>%
    set_names() %>%
    map_dfr(~ read_csv2(file = file,
                        col_names = FALSE,
                        # specify column types as not all .csv's match
                        # some examples of doubles and integers in X4
                        col_types = "n?nnnnnn"))
}, .id = "file")

files2 <- dir(path = "data/loggers_data/lygra2", pattern = "^data.*\\.csv$", full.names = TRUE, recursive = TRUE)

temp_raw2 <- map_df(set_names(files2), function(file) {
  file %>%
    set_names() %>%
    map_dfr(~ read_csv2(file = file,
                        col_names = FALSE,
                        # specify column types as not all .csv's match
                        # some examples of doubles and integers in X4
                        col_types = "n?nnnnnn"))
}, .id = "file")




```

Here the data are read in the TOMST loggers files and create new objects to work on.

```{r read_organize_data}
microclimate <- temp_raw %>%
  # rename column names
  rename("ID" = "file", "datetime" = "X2", "time_zone" = "X3", "soil_temperature" = "X4", "ground_temperature" = "X5", "air_temperature" = "X6", "RawSoilmoisture" = "X7", "Shake" = "X8", "ErrorFlag" = "X9") %>%
  # change the date and time format
  mutate(datetime = ymd_hm(datetime)) %>%

  # get logger ID by trimming characters from the file name
  mutate(
    loggerID = substr(ID, nchar(ID)-24, nchar(ID)-17),
    loggerID = as.factor(loggerID)
  ) %>%
  select(!c(ID, X1,X10)) %>% # remove unnessary columns
  distinct() %>%  # only choose unique records
  left_join(metatomst, by = "loggerID",relationship="many-to-many") %>%
   group_by(loggerID) %>%
  filter(
     datetime > "2023-06-01 00:00:01"
   ) %>%

 #soil moisture calibration
  mutate( # calculate soil moisture
    soil_moisture = soil.moist(
      rawsoilmoist = RawSoilmoisture,
      soil_temp = soil_temperature,
      soilclass = "silt_loam" #it is the closest soil class, but still very wrong. The TMS calibration tool does not have any class for our soil
    )) %>%
  select(!c(RawSoilmoisture)) %>% # we want vertical tidy data

    # Choose and order columns to keep for a wide-format database
    select(c(datetime, site, fire_class, drt_treatment, site_type,land_type, plotID, gps_loc, species, plantID,
             loggerID, date_in, date_out, h_t_left,c_t_l,h_t_r,c_t_l,h_b_l,c_b_l,h_b_r,c_b_r,
             air_temperature, ground_temperature, soil_temperature, soil_moisture,
             Shake, ErrorFlag))
  # Save clean file
   current_time <- format(Sys.time(), "%d%m%Y_%H%M%S")
   write_csv(microclimate, file = paste("data/DURIN_clean_microclimate_2023_",current_time,".csv"))
  
microclimate <- microclimate %>%
  select(c(datetime, site, fire_class, drt_treatment, site_type,land_type, plotID, gps_loc, species, plantID,
             loggerID, date_in, date_out, h_t_left,c_t_l,h_t_r,c_t_l,h_b_l,c_b_l,h_b_r,c_b_r,
             air_temperature, ground_temperature, soil_temperature, soil_moisture,
             Shake, ErrorFlag)) %>%

  pivot_longer(cols = c(air_temperature, soil_temperature, ground_temperature, soil_moisture), names_to = "sensor", values_to = "value")


microclimate2 <- temp_raw2 %>%
  # rename column names
  rename("ID" = "file", "datetime" = "X2", "time_zone" = "X3", "soil_temperature" = "X4", "ground_temperature" = "X5", "air_temperature" = "X6", "RawSoilmoisture" = "X7", "Shake" = "X8", "ErrorFlag" = "X9") %>%
  # change the date and time format
  mutate(datetime = ymd_hm(datetime)) %>%

  # get logger ID by trimming characters from the file name
  mutate(
    loggerID = substr(ID, nchar(ID)-24, nchar(ID)-17),
    loggerID = as.factor(loggerID)
  ) %>%
  select(!c(ID, X1,X10)) %>% # remove unnessary columns
  distinct() %>%  # only choose unique records
  left_join(metatomst, by = "loggerID",relationship="many-to-many") %>%
   group_by(loggerID) %>%
  filter(
     datetime > "2023-04-23 00:00:01"
   ) %>%

 #soil moisture calibration
  mutate( # calculate soil moisture
    soil_moisture = soil.moist(
      rawsoilmoist = RawSoilmoisture,
      soil_temp = soil_temperature,
      soilclass = "silt_loam" #it is the closest soil class, but still very wrong. The TMS calibration tool does not have any class for our soil
    )) %>%
  select(!c(RawSoilmoisture)) %>% # we want vertical tidy data

    # Choose and order columns to keep for a wide-format database
    select(c(datetime, site, fire_class, drt_treatment, site_type,land_type, plotID, gps_loc, species, plantID,
             loggerID, date_in, date_out, h_t_left,c_t_l,h_t_r,c_t_l,h_b_l,c_b_l,h_b_r,c_b_r,
             air_temperature, ground_temperature, soil_temperature, soil_moisture,
             Shake, ErrorFlag))
  # Save clean file
   current_time <- format(Sys.time(), "%d%m%Y_%H%M%S")
   write_csv(microclimate, file = paste("data/DURIN_clean_microclimate_2023_",current_time,".csv"))
  
microclimate2 <- microclimate2 %>%
  select(c(datetime, site, fire_class, drt_treatment, site_type,land_type, plotID, gps_loc, species, plantID,
             loggerID, date_in, date_out, h_t_left,c_t_l,h_t_r,c_t_l,h_b_l,c_b_l,h_b_r,c_b_r,
             air_temperature, ground_temperature, soil_temperature, soil_moisture,
             Shake, ErrorFlag)) %>%

  pivot_longer(cols = c(air_temperature, soil_temperature, ground_temperature, soil_moisture), names_to = "sensor", values_to = "value")


microclimate <- microclimate %>%
  mutate(date_in = as.Date(date_in, format="%d/%m/%Y")) 

microclimate2 <- microclimate2 %>%
  filter(site == "Lygra" & land_type == "DroughtNet" & datetime >= "2023-04-23")

microclimate2 <- microclimate2 %>%
    mutate(date_in = as.Date(date_in, format="%d/%m/%Y"))

microclimate2 <- microclimate2 %>%
<<<<<<< HEAD
  filter(site == "Lygra") %>%
=======
>>>>>>> beffb79ee64e525a1a801e208a8ab7acf7906cdd
  mutate(hour = substring(datetime, 12, 19),
         dayornight = ifelse(
           (datetime > "2023-04-23" & datetime < "2023-04-30" & hour > "05:57:00" & hour < "21:19") |
           (datetime > "2023-04-30" & datetime < "2023-05-07" & hour > "05:37:00" & hour < "21:37") |
           (datetime > "2023-05-07" & datetime < "2023-05-14" & hour > "05:18:00" & hour < "21:55") |
           (datetime > "2023-05-14" & datetime < "2023-06-21" & hour > "05:00:00" & hour < "22:13") |
           (datetime > "2023-05-21" & datetime < "2023-06-28" & hour > "04:43:00" & hour < "22:30") |
           (datetime > "2023-05-28" & datetime < "2023-06-04" & hour > "04:29:00" & hour < "22:45") |
           (datetime > "2023-06-04" & datetime < "2023-06-11" & hour > "04:17:00" & hour < "22:58") |
           (datetime > "2023-06-11" & datetime < "2023-06-18" & hour > "04:10:00" & hour < "23:08"),
           "day", "night"))

microclimate <- microclimate %>% 
  mutate(
    cutting = case_when(
      # air temperature cleaning
      sensor == "air_temperature" & value < -20 ~ "cut",

      # soil temperature cleaning
      sensor == "soil_temperature" & value < -20 ~ "cut",

      # ground temperature cleaning
      sensor == "ground_temperature" & value < -20 ~ "cut",

      # soil moisture cleaning
      sensor == "soil_moisture" & value <= 0 ~ "cut",
      
      # soil moisture cleaning
      sensor == "soil_moisture" & value >= 1 ~ "cut",

      TRUE ~ "keep"
    )
  )

microclimate2 <- microclimate2 %>% 
  mutate(
    cutting = case_when(
      # air temperature cleaning
      sensor == "air_temperature" & value < -20 ~ "cut",

      # soil temperature cleaning
      sensor == "soil_temperature" & value < -20 ~ "cut",

      # ground temperature cleaning
      sensor == "ground_temperature" & value < -20 ~ "cut",

      # soil moisture cleaning
      sensor == "soil_moisture" & value <= 0 ~ "cut",
      
      # soil moisture cleaning
      sensor == "soil_moisture" & value >= 1 ~ "cut",

      TRUE ~ "keep"
    )
  )

gc()


```

The objective of this section is to clean the data as much as possible before. In order to do this, we will try to avoid errors of measurements. They can be multiple (e.g bad calibration, aberrant measure,...)

Each measure will then have a specific "cutting" code: keep, cut, suspicious that is linked to the way we will treat these data.

Also, here is a list of loggers having shown some problems:
94195238 - soil_moisture
94195237 - air_temperature
95221050 - soil_temperature
94195238 - soil_moisture

```{r data_cleaning}
microclimate <- microclimate %>% 
  mutate(
    cutting = case_when(
      # air temperature cleaning
      sensor == "air_temperature" & value < -20 ~ "cut",

      # soil temperature cleaning
      sensor == "soil_temperature" & value < -20 ~ "cut",

      # ground temperature cleaning
      sensor == "ground_temperature" & value < -20 ~ "cut",

      # soil moisture cleaning
      sensor == "soil_moisture" & value <= 0 ~ "cut",
      
      # soil moisture cleaning
      sensor == "soil_moisture" & value >= 1 ~ "cut",

      TRUE ~ "keep"
    )
  )

microclimate2 <- microclimate2 %>% 
  mutate(
    cutting = case_when(
      # air temperature cleaning
      sensor == "air_temperature" & value < -20 ~ "cut",

      # soil temperature cleaning
      sensor == "soil_temperature" & value < -20 ~ "cut",

      # ground temperature cleaning
      sensor == "ground_temperature" & value < -20 ~ "cut",

      # soil moisture cleaning
      sensor == "soil_moisture" & value <= 0 ~ "cut",
      
      # soil moisture cleaning
      sensor == "soil_moisture" & value >= 1 ~ "cut",

      TRUE ~ "keep"
    )
  )
```

Here, this will save you data for logger and stock them as .png plots. You will have one file per plotID (1.1, 1.2, ... ) per data (soil_moisture, soil_temp....) and 

```{r plot_data_plotID_sensor_species}
# #soil temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_soil_temperature_", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate %>%
      filter(
        sensor == "soil_temperature" &
          datetime > "2023-04-22" &
          plotID == plot_number &
          cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, species, sep = " ")) # Add the column "logger_species" containing the concatenation of "loggerID", "plotID", "drt_treatment", and "species"

    plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = "cutting")) +
      geom_line(aes(group = logger_species)) +
      scale_color_manual(values = c(
        "keep" = "#1e90ff",
        "suspect" = "#ff0800"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
      facet_wrap(vars(logger_species), ncol = 3, scales = "free") # Use the column "logger_species" for facet_wrap

    ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}

#ground_temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_ground_temperature_", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate %>%
      filter(
        sensor == "ground_temperature" &
          datetime > "2023-04-22" &
          plotID == plot_number &
          cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, species, sep = " ")) # Add the column "logger_species" containing the concatenation of "loggerID", "plotID", "drt_treatment", and "species"

    plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = "cutting")) +
      geom_line(aes(group = logger_species)) +
      scale_color_manual(values = c(
        "keep" = "#1e90ff",
        "suspect" = "#ff0800"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
      facet_wrap(vars(logger_species), ncol = 3, scales = "free") # Use the column "logger_species" for facet_wrap

    ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}

#air_temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_air_temperature_", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate %>%
      filter(
        sensor == "air_temperature" &
          datetime > "2023-04-22" &
          plotID == plot_number &
          cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, species, sep = " ")) # Add the column "logger_species" containing the concatenation of "loggerID", "plotID", "drt_treatment", and "species"

    plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = "cutting")) +
      geom_line(aes(group = logger_species)) +
      scale_color_manual(values = c(
        "keep" = "#1e90ff",
        "suspect" = "#ff0800"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
      facet_wrap(vars(logger_species), ncol = 3, scales = "free") # Use the column "logger_species" for facet_wrap

    ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}



#soil_moisture
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_soil_moisture_", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate %>%
      filter(
        sensor == "soil_moisture" &
          datetime > "2023-04-22" &
          plotID == plot_number &
          cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, species, sep = " ")) # Add the column "logger_species" containing the concatenation of "loggerID", "plotID", "drt_treatment", and "species"

    plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = "cutting")) +
      geom_line(aes(group = logger_species)) +
      scale_color_manual(values = c(
        "keep" = "#1e90ff",
        "suspect" = "#ff0800"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
      facet_wrap(vars(logger_species), ncol = 3, scales = "free") # Use the column "logger_species" for facet_wrap

    ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}
```

Same, here the goal is to plot the data. The goal is to sort the .png by plotID, to have only 1 plot per png but to have the 3 to 5 species on it.

```{r plot_data_plotID_sensor_merged}
# #soil temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_soil_temperature_test", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate2 %>%
      filter(
        sensor == "soil_temperature" &
          datetime > "2023-04-23" &
          plotID == plot_number 
          #cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, sep = " "))

    plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
      geom_line(aes(group = loggerID, color = species)) +
      scale_color_manual(values = c(
          "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
     # Specify the x, y and colour axis labels, rather than using default names from dataset
      labs(x = "Date", y = " Air Temperature (Celsius)", colour = "Focal Species")
      ylim(-2,40)

      ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}

#ground_temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_ground_temperature_test", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate2 %>%
      filter(
        sensor == "ground_temperature" &
          datetime > "2023-04-23" &
          plotID == plot_number 
         # cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, sep = " "))

    plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
      geom_line(aes(group = loggerID, color = species)) +
      scale_color_manual(values = c(
         "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
     # Specify the x, y and colour axis labels, rather than using default names from dataset
      labs(x = "Date", y = " Air Temperature (Celsius)", colour = "Focal Species")
      ylim(-2,40)

      ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}


#air_temperature
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_air_temperature_test", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate2 %>%
      filter(
        sensor == "air_temperature" &
          datetime > "2023-04-23" &
          plotID == plot_number 
         # cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, sep = " "))

    plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
      geom_line(aes(group = loggerID, color = species)) +
      scale_color_manual(values = c(
          "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
     # Specify the x, y and colour axis labels, rather than using default names from dataset
      labs(x = "Date", y = " Ground Temperature (Celsius)", colour = "Focal Species")
      ylim(-2,40)

      ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}


#soil_moisture
for (i in 1:9) {
  for (j in 1:3) {
    plot_number <- i + j/10
    file_name <- paste("loggers_soil_moisture_test", as.character(i), "_", as.character(j), ".png", sep = "")

    filtered_data <- microclimate2 %>%
      filter(
        sensor == "soil_moisture" &
          datetime > "2023-04-23" &
          plotID == plot_number 
         # cutting != "cut"
      ) %>%
      group_by(loggerID) %>%
      mutate(logger_species = paste(loggerID, site, plotID, drt_treatment, sep = " "))

    plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
      geom_line(aes(group = loggerID, color = species)) +
      scale_color_manual(values = c(
        "Control" = "#7876B1",
        "Calluna vulgaris" = "#E18727",
        "Empetrum nigrum" = "#20854E",
        "Vaccinium vitis idea" = "#BC3C29",
        "Vaccinium myrtillus" = "#0072B5"
      )) +
      scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
     # Specify the x, y and colour axis labels, rather than using default names from dataset
      labs(x = "Date", y = " Soil Moisture ()", colour = "Focal Species")
      ylim(0.15,0.6)

      ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
  }
}
```

here the goal is at the end to have 3 .png with 9 plots, each plot has 5 species and it and they are ordered by drt_treatment and by the replicate number.

```{r plot_data_drought_aged_specie}
#air temperature
age_vector <- c("Pioneer", "Building", "Mature")
for (i in 1:3) {
  file_name <- paste("loggers_air_temperature_", age_vector[i], ".png", sep = "")
  
  filtered_data <- microclimate %>%
    filter(
      sensor == "air_temperature" &
        datetime > "2023-04-23" &
        fire_class == age_vector[i] &
        cutting != "cut" 
    ) %>%
    group_by(fire_class)  

  plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
    geom_line(aes(group = loggerID, color = species)) +
    scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
    scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    facet_grid(drt_treatment ~ substring(as.character(plotID), first = 1, last = 1), scale="free") +
    labs(x = "Date", y = " Air Temperature (Celsius)")+
    ylim(-10, 30)
  
  ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
}

#ground temperature
age_vector <- c("Pioneer", "Building", "Mature")
for (i in 1:3) {
  file_name <- paste("loggers_ground_temperature_", age_vector[i], ".png", sep = "")
  
  filtered_data <- microclimate %>%
    filter(
      sensor == "ground_temperature" &
        datetime > "2023-04-23" &
        fire_class == age_vector[i] &
        cutting != "cut" 
    ) %>%
    group_by(fire_class)  

  plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
    geom_line(aes(group = loggerID, color = species)) +
    scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
    scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    facet_grid(drt_treatment ~ substring(as.character(plotID), first = 1, last = 1), scale="free") +
    labs(x = "Date", y = " Ground Temperature (Celsius)")+
    ylim(-10, 30)
  
  ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
}

#soil temp
age_vector <- c("Pioneer", "Building", "Mature")
for (i in 1:3) {
  file_name <- paste("loggers_soil_temperature_", age_vector[i], ".png", sep = "")
  
  filtered_data <- microclimate %>%
    filter(
      sensor == "soil_temperature" &
        datetime > "2023-04-23" &
        fire_class == age_vector[i] &
        cutting != "cut" 
    ) %>%
    group_by(fire_class)  

  plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
    geom_line(aes(group = loggerID, color = species)) +
    scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum Nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
    scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    facet_grid(drt_treatment ~ substring(as.character(plotID), first = 1, last = 1), scale="free") +
    labs(x = "Date", y = " Soil Temperature (Celsius)")+
    ylim(-10, 30)
  
  ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
}

#soil moisture
age_vector <- c("Pioneer", "Building", "Mature")
for (i in 1:3) {
  file_name <- paste("loggers_soil_moisture_", age_vector[i], ".png", sep = "")
  
  filtered_data <- microclimate %>%
    filter(
      sensor == "soil_moisture" &
        datetime > "2023-04-23" &
        fire_class == age_vector[i] &
        cutting != "cut" 
    ) %>%
    group_by(fire_class)  

  plot <- ggplot(filtered_data, aes(x = datetime, y = value)) +
    geom_line(aes(group = loggerID, color = species)) +
    scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
    scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    facet_grid(drt_treatment ~ substring(as.character(plotID), first = 1, last = 1), scale="free") +
    ylim(0.10, 0.6)
  
  ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
}
```

Here the goal is to compare the differences between the 3 fire_classes. The first code makes 3 separate plots, the second one plots everything on the same


```{r control_fire_class_comparaison}
#air_temp
file_name <- paste("loggers_air_temperature_control_comparaison", age_vector[i], ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = species)) +
  scale_color_manual(values = c(
    "Control" = "#7876B1"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  facet_wrap(vars(fire_class), ncol = 3, scales = "free") +
  labs(x = "Date", y = " Air Temperature (Celsius)")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")


##ground temp
file_name <- paste("loggers_ground_temperature_control_comparaison", age_vector[i], ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class,species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = species)) +
  scale_color_manual(values = c(
    "Control" = "#7876B1"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  facet_wrap(vars(fire_class), ncol = 3, scales = "free") +
  labs(x = "Date", y = " Soil Temperature (Celsius)")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

##soil temp
file_name <- paste("loggers_soil_temperature_control_comparaison", age_vector[i], ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = species)) +
  scale_color_manual(values = c(
    "Control" = "#7876B1"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  facet_wrap(vars(fire_class), ncol = 3, scales = "free") +
  labs(x = "Date", y = " Soil Temperature (Celsius)")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

##soil moisture
file_name <- paste("loggers_soil_moisture_control_comparaison", age_vector[i], ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = species)) +
  scale_color_manual(values = c(
    "Control" = "#7876B1"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  facet_wrap(vars(fire_class), ncol = 3, scales = "free") +
    labs(x = "Date", y = " Soil Moisture (Celsius)")+
  ylim(0.15, 0.6)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
```

```{r control_fire_class_comp_same_plot}

#air_temp
file_name <- paste("loggers_air_temperature_control_comparaison_same", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_color_manual(values = c(
    "Pioneer" = "#1276B1",
    "Building" = "#C11010",
    "Mature" = "#12B612"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Temperature for Control loggers depending on fire_class",x = "Date", y = " Air Temperature (Celsius)", colour = "fire_class")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_control_comparaison_same", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_color_manual(values = c(
    "Pioneer" = "#1276B1",
    "Building" = "#C11010",
    "Mature" = "#12B612"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Temperature for Control loggers depending on fire_class",x = "Date", y = "Ground Temperature (Celsius)", colour = "fire_class")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_temperature_control_comparaison_same", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_color_manual(values = c(
    "Pioneer" = "#1276B1",
    "Building" = "#C11010",
    "Mature" = "#12B612"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  labs(title ="Mean Temperature for Control loggers depending on fire_class",x = "Date", y = " Soil Temperature (Celsius)", colour = "fire_class")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")


#air_temp
file_name <- paste("loggers_soil_moisture_control_comparaison_same", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      species == "Control" &
      cutting != "cut" 
  ) %>%
  group_by(datetime, fire_class, species) %>%
  summarize(mean_value = mean(value))


plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_color_manual(values = c(
    "Pioneer" = "#1276B1",
    "Building" = "#C11010",
    "Mature" = "#12B612"
  )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  labs(title ="Mean Soil Moisture for Control loggers depending on fire_class",x = "Date", y = " Soil Moisture")+
  ylim(0.15, 0.6)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")


```

Here it averages the combined 4 species (excludes "Control" loggers) and plots them according to fire_class / drt_treatment.

```{r mean_species_fire_class_drt_treatment}

#air_temp
file_name <- paste("loggers_air_temperature_mean_species", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment) &
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_mean_species", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Ground Temperature of every species",x = "Date", y = "Ground Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#soil_temp
file_name <- paste("loggers_soil_temperature_mean_species", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Soil Temperature of every species",x = "Date", y = " Soil Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_mean_species", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      site == "Lygra" &
      datetime < "2023-06-20" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = fire_class, color = fire_class)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean soil moisture of every species",x = "Date", y = " Soil Moisture")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(0.15, 0.6)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

```
```{r mean_drt_age_merged}
#air_temp
file_name <- paste("loggers_air_temperature_mean_species_merged", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = as.factor(drt_treatment), color = as.factor(drt_treatment))) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test", file_name), plot, height = 40, width = 80, units = "cm")


#ground_temp
file_name <- paste("loggers_ground_temperature_mean_species_merged", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = as.factor(drt_treatment), color = as.factor(drt_treatment))) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Ground Temperature of every species",x = "Date", y = " Ground Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_temperature_mean_species_merged", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = as.factor(drt_treatment), color = as.factor(drt_treatment))) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Soil Temperature of every species",x = "Date", y = " Soil Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_mean_species_merged", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = as.factor(drt_treatment), color = as.factor(drt_treatment))) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Soil Moisture of every species",x = "Date", y = " Soil Moisture (%)")+
  facet_grid(~fire_class, scale="free")+
  ylim(0.15, 0.6)

ggsave(file.path("data/plots/test", file_name), plot, height = 40, width = 80, units = "cm")

```
```{r mean_species_vs_control}
#air_temp
file_name <- paste("loggers_air_control_vs_shrub", ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  mutate(spec = ifelse(species=="Control","Control","Shrub")) %>%
  group_by(fire_class,spec, datetime) %>%
  summarize(mean_value = value)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = spec, color = spec)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Air Temperature",x = "Date", y = "Air Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test3", file_name), plot, height = 40, width = 80, units = "cm")


#ground_temp
file_name <- paste("loggers_ground_control_vs_shrub", ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  mutate(spec = ifelse(species=="Control","Control","Shrub")) %>%
  group_by(fire_class,spec,datetime) %>%
  summarize(mean_value = value)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = spec, color = spec)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Ground Temperature of every species",x = "Date", y = " Ground Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test3", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_control_vs_shrub", ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  mutate(spec = ifelse(species=="Control","Control","Shrub")) %>%
  group_by(fire_class,spec,datetime) %>%
  summarize(mean_value = value)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = spec, color = spec)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Soil Temperature of every species",x = "Date", y = " Soil Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-10, 40)

ggsave(file.path("data/plots/test3", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_control_vs_shrub", ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  mutate(spec = ifelse(species=="Control","Control","Shrub")) %>%
  group_by(fire_class,spec,datetime) %>%
  summarize(mean_value = value)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = spec, color = spec)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Soil Moisture",x = "Date", y = " Soil Moisture(%))")+
  facet_grid(~fire_class, scale="free")+
  ylim(0.15, 0.6)

ggsave(file.path("data/plots/test3", file_name), plot, height = 40, width = 80, units = "cm")
```



```{r merged_sensors}
#air_temp
file_name <- paste("loggers_temperature_sensor_merged", age_vector[i], ".png", sep = "")

filtered_data <- microclimate2 %>%
  filter(
      datetime > "2023-04-23" &
      datetime < "2023-06-20" &
      site == "Lygra" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control" &
        sensor != "soil_moisture"
  ) %>%
  group_by(fire_class, sensor, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
   geom_line(aes(group = sensor, color = sensor)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Temperature",x = "Date", y = "Temperature (Celsius)")+
  facet_grid(~fire_class, scale="free")+
  ylim(-5, 35)

ggsave(file.path("data/plots/test2", file_name), plot, height = 40, width = 80, units = "cm")

```


Her the average for every separated species is taking for each drt_treatment in each fire_class.

```{r mean_per_species_fire_class_drt_treatment}

#air_temp
file_name <- paste("loggers_air_temperature_mean_per_species",".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  group_by(fire_class, drt_treatment, species, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = species, color = species)) +
  scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_mean_per_species",".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment)
  ) %>%
  group_by(fire_class, drt_treatment, species, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = species, color = species)) +
  scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Ground Temperature of every species",x = "Date", y = " Ground Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#soil_temp
file_name <- paste("loggers_soil_temperature_mean_per_species",".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment) & 
      !is.na(value)
  ) %>%
  group_by(fire_class, drt_treatment, species, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = species, color = species)) +
  scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean Soil Temperature of every species",x = "Date", y = " Soil Temperature (Celsius)")+
  facet_grid(drt_treatment ~ fire_class, scale="free")+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_mean_per_species",".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment)& 
      !is.na(value)
  ) %>%
  group_by(fire_class, drt_treatment, species, datetime) %>%
  summarize(mean_value = mean(value))

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = species, color = species)) +
  scale_color_manual(values = c(
      "Control" = "#7876B1",
      "Calluna vulgaris" = "#E18727",
      "Empetrum nigrum" = "#20854E",
      "Vaccinium vitis idea" = "#BC3C29",
      "Vaccinium myrtillus" = "#0072B5"
    )) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
    labs(title ="Mean soil moisture of every species",x = "Date", y = " Soil moisture")+
  facet_grid(drt_treatment ~ fire_class, scales="free")

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
```
temporary code just in case you wanna do something at one point
```{r temporary}


#air_temp

file_name <- paste("loggers_air_temperature_mean_species_test2", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment) &
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

filtered_data$drt_treatment <- factor(filtered_data$drt_treatment)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = drt_treatment, color = drt_treatment)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
   scale_color_manual(values = c(
        "0" = "#7876B1",
        "50" = "#E18727",
        "90" = "#20854E"
      )) +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_wrap(~fire_class)+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_mean_species_test2", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

filtered_data$drt_treatment <- factor(filtered_data$drt_treatment)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = drt_treatment, color = drt_treatment)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
   scale_color_manual(values = c(
        "0" = "#7876B1",
        "50" = "#E18727",
        "90" = "#20854E"
      )) +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_wrap(~fire_class)+
  ylim(-10, 30)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

#soil_temp
file_name <- paste("loggers_soil_temperature_mean_species_test2", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment) &
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

filtered_data$drt_treatment <- factor(filtered_data$drt_treatment)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = drt_treatment, color = drt_treatment)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
   scale_color_manual(values = c(
        "0" = "#7876B1",
        "50" = "#E18727",
        "90" = "#20854E"
      )) +
    labs(title ="Mean Air Temperature of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_wrap(~fire_class)+
  ylim(4, 15)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")
#soil_moisture
file_name <- paste("loggers_soil_moisture_mean_species_test2", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
      datetime > "2023-04-23" &
      cutting != "cut" &
      !is.na(drt_treatment)&
      species != "Control"
  ) %>%
  group_by(fire_class, drt_treatment, datetime) %>%
  summarize(mean_value = mean(value))

filtered_data$drt_treatment <- factor(filtered_data$drt_treatment)

plot <- ggplot(filtered_data, aes(x = datetime, y = mean_value)) +
  geom_line(aes(group = drt_treatment, color = drt_treatment)) +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
   scale_color_manual(values = c(
        "0" = "#7876B1",
        "50" = "#E18727",
        "90" = "#20854E"
      )) +
    labs(title ="Mean soil moisture of every species",x = "Date", y = " Air Temperature (Celsius)")+
  facet_wrap(~fire_class)+
  ylim(0.15,0.6)

ggsave(file.path("data/plots", file_name), plot, height = 40, width = 80, units = "cm")

```
```{r senja_per_species_forest}


#air_temp

file_name <- paste("loggers_air_temperature_senja_perspecies_forest", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Forested"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_senja_perspecies_forest", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Forested"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_temperature_senja_perspecies_forest", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Forested"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_senja_perspecies_forest", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Forested"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0.05, 0.6)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")
```

```{r per_species_open}
#air_temp

file_name <- paste("loggers_air_temperature_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_temperature_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0.05, 0.6)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")
```

```{r mean_forest_vs_open_per_species}
#air_temp

file_name <- paste("loggers_air_temperature_senja_perspecies_open_vs_forest", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "air_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" 

  ) %>%
  group_by(species) %>%
  

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#ground_temp
file_name <- paste("loggers_ground_temperature_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "ground_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")


#soil_temp
file_name <- paste("loggers_soil_temperature_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_temperature" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0, 40)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")

#soil_moisture
file_name <- paste("loggers_soil_moisture_senja_perspecies_open", ".png", sep = "")

filtered_data <- microclimate %>%
  filter(
    sensor == "soil_moisture" &
    datetime > "2023-07-11" &
    cutting != "cut" &
    site == "Senja" & 
    land_type == "Open"
  ) %>%
  group_by(species)

plot <- ggplot(filtered_data, aes(x = datetime, y = value, color = as.factor(plotID))) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 week", minor_breaks = "1 day", date_labels = "%e/%m/%y") +
  scale_color_manual(values = c(
    "1" = "#7876B1",
    "2" = "#E18727",
    "3" = "#20854E",
    "4" = "#E1E100",
    "5" = "#E51010"
  )) +
  facet_wrap(~species) +
  ylim(0.05, 0.6)

ggsave(file.path("data/plots/senja", file_name), plot, height = 40, width = 80, units = "cm")
```

```{r micro_data_filter}

micro_data <- microclimate %>%
  filter(cutting != "cut" & datetime > "2023-06-27" & datetime < "2023-07-19" & date_in < "2023-07-01" & land_type != "DroughtNet") %>%
  mutate(daytime = floor_date(datetime, "day") ) %>%
  group_by(loggerID, daytime, site,plotID,land_type,species) %>%
  summarise(
    air_temperature_mean = mean(value[sensor == "air_temperature"]),
    air_temperature_min = min(value[sensor == "air_temperature"]),
    air_temperature_max = max(value[sensor == "air_temperature"]),
    air_temperature_range = max(value[sensor == "air_temperature"]) - min(value[sensor == "air_temperature"]),
    ground_temperature_mean = mean(value[sensor == "ground_temperature"]),
    ground_temperature_min = min(value[sensor == "ground_temperature"]),
    ground_temperature_max = max(value[sensor == "ground_temperature"]),
    ground_temperature_range = max(value[sensor == "ground_temperature"]) - min(value[sensor == "ground_temperature"]),
    soil_temperature_mean = mean(value[sensor == "soil_temperature"]),
    soil_temperature_min = min(value[sensor == "soil_temperature"]),
    soil_temperature_max = max(value[sensor == "soil_temperature"]),
    soil_temperature_range = max(value[sensor == "soil_temperature"]) - min(value[sensor == "soil_temperature"]),
    soil_moisture_mean = mean(value[sensor == "soil_moisture"]),
    soil_moisture_min = min(value[sensor == "soil_moisture"]),
    soil_moisture_max = max(value[sensor == "soil_moisture"]),
    soil_moisture_range = max(value[sensor == "soil_moisture"]) - min(value[sensor == "soil_moisture"]),
  )

micro_data <- micro_data %>%
     mutate(below_zero_air = ifelse(air_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_ground = ifelse(ground_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_soil = ifelse(soil_temperature_min < 0.5, 1, 0))

```
```{r plot_site_by_landtype}


base_air <- ggplot(micro_data, aes(x = land_type, y = air_temperature_mean, fill = land_type))
graph_air <- base_air + 
  geom_boxplot(outlier.shape = NA) +
  labs(y = "Air Temperature +15cm (°C)",x="Type of the land") +
  theme_bw() +
  scale_x_discrete(labels = c("Forested" = "Forested", "Open" = "Open")) +
  facet_wrap(~site, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = c("Forested" = "#1e90ff", "Open" = "#ff0800"))

ggsave(file.path("data/plots", "By_site_by_landtype_air_temp.png"), graph_air, height = 40, width = 80, units = "cm")

base_ground <- ggplot(micro_data, aes(x = land_type, y = ground_temperature_mean, fill = land_type))
graph_ground <- base_ground+ 
  geom_boxplot(outlier.shape = NA) +
  labs(y = "Ground Temperature +2cm (°C)",x="Type of the land") +
  theme_bw() +
  scale_x_discrete(labels = c("Forested" = "Forested", "Open" = "Open")) +
  facet_wrap(~site, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = c("Forested" = "#1e90ff", "Open" = "#ff0800"))

ggsave(file.path("data/plots", "By_site_by_landtype_ground_temp.png"), graph_ground, height = 40, width = 80, units = "cm")

base_soil <- ggplot(micro_data, aes(x = land_type, y = soil_temperature_mean, fill = land_type))
graph_soil <- base_soil + 
  geom_boxplot(outlier.shape = NA) +
  labs(y = "Soil Temperature -6cm (°C)",x="Type of the land") +
  theme_bw() +
  scale_x_discrete(labels = c("Forested" = "Forested", "Open" = "Open")) +
  facet_wrap(~site, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = c("Forested" = "#1e90ff", "Open" = "#ff0800"))

ggsave(file.path("data/plots", "By_site_by_landtype_soil_temp.png"), graph_soil, height = 40, width = 80, units = "cm")

base_moist <- ggplot(micro_data, aes(x = land_type, y = soil_moisture_mean, fill = land_type))
graph_moist <- base_moist + 
  geom_boxplot(outlier.shape = NA) +
  labs(y = "Soil Moisture (°C)",x="Type of the land") +
  theme_bw() +
  scale_x_discrete(labels = c("Forested" = "Forested", "Open" = "Open")) +
  facet_wrap(~site, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = c("Forested" = "#1e90ff", "Open" = "#ff0800"))

ggsave(file.path("data/plots", "By_site_by_landtype_soil_moist.png"), graph_moist, height = 40, width = 80, units = "cm")


```

```{r sup}
#LOGGERS WITH NO METADATA

to_sup <- microclimate2 %>%
  filter(is.na(land_type)) %>%
  group_by(loggerID) %>%
  distinct(loggerID)

to_sup <- microclimate %>%
  filter(is.infinite(soil_moisture_min)) %>%
  distinct(loggerID)

```

```{r species_test}
base_air_species <- ggplot(micro_data, aes(x = land_type, y = air_temperature_mean,fill=species))
graph_air_species <- base_air_species + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800","#E2E010","#10E110"))+ 
    facet_wrap(~site, scales = "free_x") +
  labs(y = "Air Temperature +15cm (°C)",x="Type of the land") +
  theme_bw() 

  

ggsave(file.path("data/plots", "By_site_species_air_temp.png"), graph_air_species, height = 40, width = 80, units = "cm")

base_ground_species <- ggplot(micro_data, aes(x = land_type, y = ground_temperature_mean,fill=species))
graph_ground_species <- base_ground_species + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800","#E2E010","#10E110"))+ 
    facet_wrap(~site, scales = "free_x") +
  labs(y = "Ground Temperature +2cm (°C)",x="Type of the land") +
  theme_bw() 

  

ggsave(file.path("data/plots", "By_site_species_ground_temp.png"), graph_ground_species, height = 40, width = 80, units = "cm")
# 

base_soil_species <- ggplot(micro_data, aes(x = land_type, y = soil_temperature_mean,fill=species))
graph_soil_species <- base_soil_species + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800","#E2E010","#10E110"))+ 
    facet_wrap(~site, scales = "free_x") +
  labs(y = "Soil Temperature -6 (°C)",x="Type of the land") +
  theme_bw() 

  

ggsave(file.path("data/plots", "By_site_species_soil_temp.png"), graph_soil_species, height = 40, width = 80, units = "cm")
# 
base_soil_moisture_species <- ggplot(micro_data, aes(x = land_type, y = soil_moisture_mean,fill=species))
graph_soil_moisture_species <- base_soil_moisture_species + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800","#E2E010","#10E110"))+ 
    facet_wrap(~site, scales = "free_x") +
  labs(y = "Soil moisture (%)",x="Type of the land") +
  theme_bw() 

  

ggsave(file.path("data/plots", "By_site_species_soil_moisture.png"), graph_soil_moisture_species, height = 40, width = 80, units = "cm")

```

```{r micro_data2 lygra droughtnet}



micro_data2 <- microclimate2 %>%
  filter(cutting != "cut" & datetime > "2023-04-28" & datetime < "2023-06-20" & land_type == "DroughtNet" & loggerID != 95221050) %>%
  mutate(daytime = floor_date(datetime, "day")) %>%
  group_by(loggerID,daytime,plotID,species,drt_treatment,fire_class) %>%
  summarise(
    air_temperature_mean = mean(value[sensor == "air_temperature"]),
    air_temperature_min = min(value[sensor == "air_temperature"]),
    air_temperature_max = max(value[sensor == "air_temperature"]),
    air_temperature_range = max(value[sensor == "air_temperature"]) - min(value[sensor == "air_temperature"]),
    ground_temperature_mean = mean(value[sensor == "ground_temperature"]),
    ground_temperature_min = min(value[sensor == "ground_temperature"]),
    ground_temperature_max = max(value[sensor == "ground_temperature"]),
    ground_temperature_range = max(value[sensor == "ground_temperature"]) - min(value[sensor == "ground_temperature"]),
    soil_temperature_mean = mean(value[sensor == "soil_temperature"]),
    soil_temperature_min = min(value[sensor == "soil_temperature"]),
    soil_temperature_max = max(value[sensor == "soil_temperature"]),
    soil_temperature_range = max(value[sensor == "soil_temperature"]) - min(value[sensor == "soil_temperature"]),
    soil_moisture_mean = mean(value[sensor == "soil_moisture"]),
    soil_moisture_min = min(value[sensor == "soil_moisture"]),
    soil_moisture_max = max(value[sensor == "soil_moisture"]),
    soil_moisture_range = max(value[sensor == "soil_moisture"]) - min(value[sensor == "soil_moisture"])
  )

micro_data2 <- micro_data2 %>%
     mutate(below_zero_air = ifelse(air_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_ground = ifelse(ground_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_soil = ifelse(soil_temperature_min < 0.5, 1, 0)) %>%
   mutate(species2 = ifelse(species == "Control", "Control", "Shrubs"))

```

```{r micro_data3 day or night}

micro_data3 <- microclimate2 %>%
  filter(cutting != "cut" & datetime > "2023-04-28" & datetime < "2023-06-20" & land_type == "DroughtNet" & loggerID != 95221050 & loggerID !=94195237) %>%
  mutate(daytime = floor_date(datetime, "day"),species=species ) %>%
  group_by(loggerID, daytime,dayornight,plotID,species,drt_treatment,fire_class) %>%
  summarise(
    air_temperature_mean = mean(value[sensor == "air_temperature"]),
    air_temperature_min = min(value[sensor == "air_temperature"]),
    air_temperature_max = max(value[sensor == "air_temperature"]),
    air_temperature_range = max(value[sensor == "air_temperature"]) - min(value[sensor == "air_temperature"]),
    ground_temperature_mean = mean(value[sensor == "ground_temperature"]),
    ground_temperature_min = min(value[sensor == "ground_temperature"]),
    ground_temperature_max = max(value[sensor == "ground_temperature"]),
    ground_temperature_range = max(value[sensor == "ground_temperature"]) - min(value[sensor == "ground_temperature"]),
    soil_temperature_mean = mean(value[sensor == "soil_temperature"]),
    soil_temperature_min = min(value[sensor == "soil_temperature"]),
    soil_temperature_max = max(value[sensor == "soil_temperature"]),
    soil_temperature_range = max(value[sensor == "soil_temperature"]) - min(value[sensor == "soil_temperature"]),
    soil_moisture_mean = mean(value[sensor == "soil_moisture"]),
    soil_moisture_min = min(value[sensor == "soil_moisture"]),
    soil_moisture_max = max(value[sensor == "soil_moisture"]),
    soil_moisture_range = max(value[sensor == "soil_moisture"]) - min(value[sensor == "soil_moisture"]),
  )

micro_data3 <- micro_data3 %>%
     mutate(below_zero_air = ifelse(air_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_ground = ifelse(ground_temperature_min < 0.5, 1, 0)) %>%
     mutate(below_zero_soil = ifelse(soil_temperature_min < 0.5, 1, 0)) %>%
     mutate(species2 = ifelse(species == "Control", "Control", "Shrubs"))
    
```

```{r droughtnet_day_and_night}
base_air <- ggplot(micro_data3, aes(x = dayornight, y = air_temperature_mean,fill=species2))
graph_air <- base_air + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~drt_treatment, scales = "free_x") +
  labs(y = "Air Temperature +15cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_air_temp_drt.png"), graph_air, height = 40, width = 80, units = "cm")



base_ground <- ggplot(micro_data3, aes(x = dayornight, y = ground_temperature_mean,fill=species2))
graph_ground <- base_ground + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~drt_treatment, scales = "free_x") +
  labs(y = "Ground +2cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_ground_temp_drt.png"), graph_ground, height = 40, width = 80, units = "cm")


base_soil <- ggplot(micro_data3, aes(x = dayornight, y = soil_temperature_mean,fill=species2))
graph_soil <- base_soil + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~drt_treatment, scales = "free_x") +
  labs(y = "Soil Temperature -6cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_soil_temp_drt.png"), graph_soil, height = 40, width = 80, units = "cm")



base_soilm <- ggplot(micro_data3, aes(x = dayornight, y = soil_moisture_mean,fill=species2))
graph_soilm<- base_soilm+ 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~drt_treatment, scales = "free_x") +
  labs(y = "Soil Moisture",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_soil_moisture_drt.png"), graph_soilm, height = 40, width = 80, units = "cm")


base_air <- ggplot(micro_data3, aes(x = dayornight, y = air_temperature_mean,fill=species2))
graph_air <- base_air + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~fire_class, scales = "free_x") +
  labs(y = "Air Temperature +15cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_air_temp_fire.png"), graph_air, height = 40, width = 80, units = "cm")



base_ground <- ggplot(micro_data3, aes(x = dayornight, y = ground_temperature_mean,fill=species2))
graph_ground <- base_ground + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~fire_class, scales = "free_x") +
  labs(y = "Ground +2cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_ground_temp_fire.png"), graph_ground, height = 40, width = 80, units = "cm")


base_soil <- ggplot(micro_data3, aes(x = dayornight, y = soil_temperature_mean,fill=species2))
graph_soil <- base_soil + 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~fire_class, scales = "free_x") +
  labs(y = "Soil Temperature -6cm (°C)",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_soil_temp_fire.png"), graph_soil, height = 40, width = 80, units = "cm")



base_soilm <- ggplot(micro_data3, aes(x = dayornight, y = soil_moisture_mean,fill=species2))
graph_soilm<- base_soilm+ 
  geom_boxplot() +
  scale_fill_manual(values = c("#1e90ff","#ff0800"))+ 
    facet_wrap(~fire_class, scales = "free_x") +
  labs(y = "Soil Moisture",x="Day or night") +
  theme_bw() 

ggsave(file.path("data/plots/testdayornight", "By_controlvsshrub_soil_moisture_fire.png"), graph_soilm, height = 40, width = 80, units = "cm")

  
```

```{r linear_model_tests_lyse}
micro_linear <- micro_data 


micro_linear$individual <- with(micro_linear, interaction(species, plotID))

###air_temperature
# Example of fixed effects comparisons, with same random effects structure

##no variance within the loggerID selection
##
model_1_air <- lmer(air_temperature_mean ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_air)
anova(model_1_air)

model_1a_air <- lmer(air_temperature_mean ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_air <- lmer(air_temperature_mean ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_air <- lmer(air_temperature_mean ~ site*land_type + (1|species), data = micro_linear)
model_1s_air <- lmer(air_temperature_mean ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_air <- lmer(air_temperature_mean ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_air <- lmer(air_temperature_mean ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_air,model_1a_air,model_1as_air,model_1s_air,model_1b_air,model_1bs_air,model_1c_air)
##
##
model_1_air <- lmer(air_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_air)
anova(model_1_air)
model_1a_air <- lmer(air_temperature_max ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_air <- lmer(air_temperature_max ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_air <- lmer(air_temperature_max ~ site*land_type + (1|species), data = micro_linear)
model_1s_air <- lmer(air_temperature_max ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_air <- lmer(air_temperature_max ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_air <- lmer(air_temperature_max ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_air,model_1a_air,model_1as_air,model_1s_air,model_1b_air,model_1bs_air,model_1c_air)
##
##
model_1_air <- lmer(air_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_air)
anova(model_1_air)
model_1a_air <- lmer(air_temperature_min ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_air <- lmer(air_temperature_min ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_air <- lmer(air_temperature_min ~ site*land_type + (1|species), data = micro_linear)
model_1s_air <- lmer(air_temperature_min ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_air <- lmer(air_temperature_min ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_air <- lmer(air_temperature_min ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_air,model_1a_air,model_1as_air,model_1s_air,model_1b_air,model_1bs_air,model_1c_air)
##
##
model_1_air <- lmer(air_temperature_range ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_air)
anova(model_1_air)
model_1a_air <- lmer(air_temperature_range ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_air <- lmer(air_temperature_range ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_air <- lmer(air_temperature_range ~ site*land_type + (1|species), data = micro_linear)
model_1s_air <- lmer(air_temperature_range ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_air <- lmer(air_temperature_range ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_air <- lmer(air_temperature_range ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_air,model_1a_air,model_1as_air,model_1s_air,model_1b_air,model_1bs_air,model_1c_air)
##


###ground_temperature
# Example of fixed effects comparisons, with same random effects structure

##
model_1_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_ground)
anova(model_1_ground)
model_1a_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|species), data = micro_linear)
model_1s_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_ground <- lmer(ground_temperature_mean ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_ground,model_1s_ground,model_1a_ground,model_1as_ground,model_1b_ground,model_1bs_ground,model_1c_ground)
##
##
model_1_ground <- lmer(ground_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_ground)
anova(model_1_ground)
model_1a_ground <- lmer(ground_temperature_max ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_ground <- lmer(ground_temperature_max ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_ground <- lmer(ground_temperature_max ~ site*land_type + (1|species), data = micro_linear)
model_1s_ground <- lmer(ground_temperature_max ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_ground <- lmer(ground_temperature_max ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_ground <- lmer(ground_temperature_max ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_ground,model_1s_ground,model_1a_ground,model_1as_ground,model_1b_ground,model_1bs_ground,model_1c_ground)
##
##
model_1_ground <- lmer(ground_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_ground)
anova(model_1_ground)
model_1a_ground <- lmer(ground_temperature_min ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_ground <- lmer(ground_temperature_min ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_ground <- lmer(ground_temperature_min ~ site*land_type + (1|species), data = micro_linear)
model_1s_ground <- lmer(ground_temperature_min ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_ground <- lmer(ground_temperature_min ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_ground <- lmer(ground_temperature_min ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_ground,model_1s_ground,model_1a_ground,model_1as_ground,model_1b_ground,model_1bs_ground,model_1c_ground)
##
##
model_1_ground <- lmer(ground_temperature_range ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_1_ground)
anova(model_1_ground)
model_1a_ground <- lmer(ground_temperature_range ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_ground <- lmer(ground_temperature_range ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_ground <- lmer(ground_temperature_range ~ site*land_type + (1|species), data = micro_linear)
model_1s_ground <- lmer(ground_temperature_range ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_ground <- lmer(ground_temperature_range ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
model_1bs_ground <- lmer(ground_temperature_range ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_ground,model_1s_ground,model_1a_ground,model_1as_ground,model_1b_ground,model_1bs_ground,model_1c_ground)
##


###soil_temperature
# Example of fixed effects comparisons, with same random effects structure
##
model_1_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|species), data = micro_linear)
model_1s_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_soil)
anova(model_1as_soil)
model_1bs_soil <- lmer(soil_temperature_mean ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_soil,model_1s_soil,model_1a_soil,model_1as_soil,model_1b_soil,model_1bs_soil,model_1c_soil)
##
##
model_1_soil <- lmer(soil_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_soil <- lmer(soil_temperature_max ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_soil <- lmer(soil_temperature_max ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_soil <- lmer(soil_temperature_max ~ site*land_type + (1|species), data = micro_linear)
model_1s_soil <- lmer(soil_temperature_max ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_soil <- lmer(soil_temperature_max ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_soil)
anova(model_1as_soil)
model_1bs_soil <- lmer(soil_temperature_max ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_soil,model_1s_soil,model_1a_soil,model_1as_soil,model_1b_soil,model_1bs_soil,model_1c_soil)
##
##
model_1_soil <- lmer(soil_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_soil <- lmer(soil_temperature_min ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_soil <- lmer(soil_temperature_min ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_soil <- lmer(soil_temperature_min ~ site*land_type + (1|species), data = micro_linear)
model_1s_soil <- lmer(soil_temperature_min ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_soil <- lmer(soil_temperature_min ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_soil)
anova(model_1as_soil)
model_1bs_soil <- lmer(soil_temperature_min ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_soil,model_1s_soil,model_1a_soil,model_1as_soil,model_1b_soil,model_1bs_soil,model_1c_soil)
##
##
model_1_soil <- lmer(soil_temperature_range ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_soil <- lmer(soil_temperature_range ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_soil <- lmer(soil_temperature_range ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_soil <- lmer(soil_temperature_range ~ site*land_type + (1|species), data = micro_linear)
model_1s_soil <- lmer(soil_temperature_range ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_soil <- lmer(soil_temperature_range ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_soil)
anova(model_1as_soil)
model_1bs_soil <- lmer(soil_temperature_range ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)
anova(model_1_soil,model_1s_soil,model_1a_soil,model_1as_soil,model_1b_soil,model_1bs_soil,model_1c_soil)
##




###soil moisture
# Example of fixed effects comparisons, with same random effects structure
##
model_1_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|species), data = micro_linear)
model_1s_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_moist)
anova(model_1as_moist)
model_1bs_moist <- lmer(soil_moisture_mean ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)

anova(model_1_moist,model_1s_moist,model_1a_moist,model_1as_moist,model_1b_moist,model_1bs_moist,model_1c_moist)
model_1_moist <- lmer(soil_moisture_max ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_moist <- lmer(soil_moisture_max ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_moist <- lmer(soil_moisture_max ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_moist <- lmer(soil_moisture_max ~ site*land_type + (1|species), data = micro_linear)
model_1s_moist <- lmer(soil_moisture_max ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_moist <- lmer(soil_moisture_max ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_moist)
anova(model_1as_moist)
model_1bs_moist <- lmer(soil_moisture_max ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)

anova(model_1_moist,model_1s_moist,model_1a_moist,model_1as_moist,model_1b_moist,model_1bs_moist,model_1c_moist)
##
##
model_1_moist <- lmer(soil_moisture_min ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_moist <- lmer(soil_moisture_min ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_moist <- lmer(soil_moisture_min ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_moist <- lmer(soil_moisture_min ~ site*land_type + (1|species), data = micro_linear)
model_1s_moist <- lmer(soil_moisture_min ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_moist <- lmer(soil_moisture_min ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_moist)
anova(model_1as_moist)
model_1bs_moist <- lmer(soil_moisture_min ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)

anova(model_1_moist,model_1s_moist,model_1a_moist,model_1as_moist,model_1b_moist,model_1bs_moist,model_1c_moist)
##
##
model_1_moist <- lmer(soil_moisture_range ~ site*land_type + (1|daytime), data = micro_linear)
model_1a_moist <- lmer(soil_moisture_range ~ site*land_type + (1|loggerID), data = micro_linear)
model_1b_moist <- lmer(soil_moisture_range ~ site*land_type + (1|plotID), data = micro_linear)
model_1c_moist <- lmer(soil_moisture_range ~ site*land_type + (1|species), data = micro_linear)
model_1s_moist <- lmer(soil_moisture_range ~ site*land_type + (1|daytime)+ (1|species), data = micro_linear)
model_1as_moist <- lmer(soil_moisture_range ~ site*land_type + (1|loggerID)+ (1|species), data = micro_linear)
summary(model_1as_moist)
anova(model_1as_moist)
model_1bs_moist <- lmer(soil_moisture_range ~ site*land_type + (1|plotID)+ (1|species), data = micro_linear)

anova(model_1_moist,model_1s_moist,model_1a_moist,model_1as_moist,model_1b_moist,model_1bs_moist,model_1c_moist)
##





```

Droughtnet ones

```{r linear_lygra_dn}


micro_linear2 <- micro_data2 %>%
  filter(species !="Control") %>%
  mutate(drt_treatment = as.factor(drt_treatment))

micro_linear3 <- micro_data3  %>%
  filter(species != "Control") %>%
  mutate(drt_treatment = as.factor(drt_treatment))


#### fire_class + drought_net
# Example of fixed effects comparisons, with same random effects structure
##
  dn_model_1_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
  dn_model_1a_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  emm <- emmeans(dn_model_1a_air)
  summary_table <- summary(emm)
  print(summary_table)

  dn_model_1b_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)
  dn_model_1c_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|species), data = micro_linear2)
  dn_model_1s_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)
  dn_model_1as_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)
  dn_model_1bs_air <- lmer(air_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)

##
  ##
  dn_model_1_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
  dn_model_1a_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
   summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)
  dn_model_1c_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|species), data = micro_linear2)
  dn_model_1s_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)
  dn_model_1as_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)
  dn_model_1bs_air <- lmer(air_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)

##
  dn_model_1_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
  
  dn_model_1a_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
   summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)
  
  dn_model_1c_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|species), data = micro_linear2)
  
  dn_model_1s_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)
  
  dn_model_1as_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)
  
  dn_model_1bs_air <- lmer(air_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)


##
dn_model_1_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
  
  dn_model_1a_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  
  dn_model_1b_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)
  
  dn_model_1c_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|species), data = micro_linear2)
  
  dn_model_1s_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)
  
  dn_model_1as_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)
  
  dn_model_1bs_air <- lmer(air_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)
  
  
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")

########
dn_model_1_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)
  

dn_model_1b_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_ground <- lmer(ground_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)

dn_model_1b_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_ground <- lmer(ground_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)


dn_model_1b_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_ground <- lmer(ground_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)


dn_model_1b_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_ground <- lmer(ground_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##






###

metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")



##  
dn_model_1_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_soil <- lmer(soil_temperature_mean ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
  summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_soil <- lmer(soil_temperature_max ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_soil <- lmer(soil_temperature_min ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)

dn_model_1a_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_soil <- lmer(soil_temperature_range ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##




#############################################################################################

metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


###  
dn_model_1_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
summary(dn_model_1a_moist)
  anova(dn_model_1a_moist)

dn_model_1b_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_moist <- lmer(soil_moisture_mean ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
summary(dn_model_1_moist)
  anova(dn_model_1_moist)

dn_model_1a_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)
summary(dn_model_1a_moist)
  anova(dn_model_1a_moist)

dn_model_1b_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_moist <- lmer(soil_moisture_max ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data =micro_linear2) 
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)


dn_model_1b_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_moist <- lmer(soil_moisture_min ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data =micro_linear2) 
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|loggerID), data = micro_linear2)
summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|daytime), data = micro_linear2)


dn_model_1b_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|plotID/loggerID), data = micro_linear2)


dn_model_1c_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|species), data = micro_linear2)

dn_model_1s_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|loggerID)+ (1|species), data = micro_linear2)


dn_model_1as_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|daytime) + (1|species), data = micro_linear2)


dn_model_1bs_moist <- lmer(soil_moisture_range ~ fire_class*drt_treatment + (1|plotID/loggerID) + (1|species), data = micro_linear2)
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###





# #########################################
# ##### day or night
# micro_linear3 <- micro_linear3 %>%
#   filter(species!="Control")
# day_model_1_air <- lmer(air_temperature_mean ~ drt_treatment*dayornight + (1|daytime), data = micro_linear3)
# day_model_1a_air <- lmer(air_temperature_mean ~ drt_treatment*dayornight + (1|fire_class), data = micro_linear3)
# day_model_1b_air <- lmer(air_temperature_mean ~ drt_treatment*dayornight + (1|loggerID), data = micro_linear3)
# day_model_1c_air <- lmer(air_temperature_mean ~ fire_class*dayornight + (1|daytime), data = micro_linear3)
# day_model_1d_air <- lmer(air_temperature_mean ~ drt_treatment*dayornight + (1|daytime) + (1|fire_class), data = micro_linear3)
# day_model_1e_air <- lmer(air_temperature_mean ~ drt_treatment*dayornight*fire_class + (1|daytime), data = micro_linear3)
# 
# anova(day_model_1_air,day_model_1a_air,day_model_1b_air,day_model_1c_air,day_model_1d_air,day_model_1e_air)
# 
# day_model_1_ground <- lmer(ground_temperature_mean ~ drt_treatment*dayornight + (1|daytime), data = micro_linear3)
# day_model_1a_ground <- lmer(ground_temperature_mean ~ drt_treatment*dayornight + (1|fire_class), data = micro_linear3)
# day_model_1b_ground <- lmer(ground_temperature_mean ~ drt_treatment*dayornight + (1|loggerID), data = micro_linear3)
# day_model_1c_ground <- lmer(ground_temperature_mean ~ fire_class*dayornight + (1|daytime), data = micro_linear3)
# day_model_1d_ground <- lmer(ground_temperature_mean ~ drt_treatment*dayornight + (1|daytime) + (1|fire_class), data = micro_linear3)
# day_model_1e_ground <- lmer(ground_temperature_mean ~ drt_treatment*dayornight*fire_class + (1|daytime), data = micro_linear3)
# 
# anova(day_model_1_ground,day_model_1a_ground,day_model_1b_ground,day_model_1c_ground,day_model_1d_ground,day_model_1e_ground)
# 
# 
# day_model_1_soil <- lmer(soil_temperature_mean ~ drt_treatment*dayornight + (1|daytime), data = micro_linear3)
# day_model_1a_soil <- lmer(soil_temperature_mean ~ drt_treatment*dayornight + (1|fire_class), data = micro_linear3)
# day_model_1b_soil <- lmer(soil_temperature_mean ~ drt_treatment*dayornight + (1|loggerID), data = micro_linear3)
# day_model_1c_soil <- lmer(soil_temperature_mean ~ fire_class*dayornight + (1|daytime), data = micro_linear3)
# day_model_1d_soil <- lmer(soil_temperature_mean ~ drt_treatment*dayornight + (1|daytime) + (1|fire_class), data = micro_linear3)
# day_model_1e_soil <- lmer(soil_temperature_mean ~ drt_treatment*dayornight*fire_class + (1|daytime) + (1|fire_class), data = micro_linear3)
# 
# anova(day_model_1_soil,day_model_1a_soil,day_model_1b_soil,day_model_1c_soil,day_model_1d_soil,day_model_1e_soil)
# 
# day_model_1_moist <- lmer(soil_moisture_mean ~ drt_treatment*dayornight + (1|daytime), data = micro_linear3)
# day_model_1a_moist <- lmer(soil_moisture_mean ~ drt_treatment*dayornight + (1|fire_class), data = micro_linear3)
# day_model_1b_moist <- lmer(soil_moisture_mean ~ drt_treatment*dayornight + (1|loggerID), data = micro_linear3)
# day_model_1c_moist <- lmer(soil_moisture_mean ~ fire_class*dayornight + (1|daytime), data = micro_linear3)
# day_model_1d_moist <- lmer(soil_moisture_mean ~ drt_treatment*dayornight + (1|daytime) + (1|fire_class), data = micro_linear3)
# day_model_1e_moist <- lmer(soil_moisture_mean ~ drt_treatment*dayornight*fire_class + (1|daytime) + (1|fire_class), data = micro_linear3)
# 
# anova(day_model_1_moist,day_model_1a_moist,day_model_1b_moist,day_model_1c_moist,day_model_1d_moist,day_model_1e_moist)

```

```{r test_plot_modelbased}
# 2. Obtain estimated means
means_air <- estimate_means(model_3_air)


# 3. Plot
ggplot(micro_linear, aes(x = land_type, y = air_temperature_mean)) +
  facet_grid(~site)+
  # Add base data
  geom_violin(aes(fill = land_type), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = means_air, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = means_air,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_material() +
  theme_modern()
```

```{r plots_dn}
# 2. Obtain estimated means
dn_1_means_air <- estimate_means(dn_model_1_air, at = c("fire_class","drt_treatment"))
dn_1_means_ground <- estimate_means(dn_model_1_ground, at = c("fire_class","drt_treatment"))
dn_1_means_soil <- estimate_means(dn_model_1_soil, at = c("fire_class","drt_treatment"))
dn_1_means_moist <- estimate_means(dn_model_1_moist, at = c("fire_class","drt_treatment"))


###### PLOTS ONLY DAY AND NIGHT############
plot <- ggplot(micro_linear2, aes(x = drt_treatment, y = air_temperature_mean)) +
  facet_grid(~fire_class)+
  # Add base data
  geom_violin(aes(fill = drt_treatment), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_1_means_air, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_1_means_air,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_material() +
  theme_modern()
ggsave(file.path("data/test_mixed", "air_dn_1.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear2, aes(x = drt_treatment, y = ground_temperature_mean)) +
  facet_grid(~fire_class)+
  # Add base data
  geom_violin(aes(fill = drt_treatment), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_1_means_ground, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_1_means_ground,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_material() +
  theme_modern()
ggsave(file.path("data/test_mixed", "ground_dn_1.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear2, aes(x = drt_treatment, y = soil_temperature_mean)) +
  facet_grid(~fire_class)+
  # Add base data
  geom_violin(aes(fill = drt_treatment), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_1_means_soil, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_1_means_soil,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_material() +
  theme_modern()
ggsave(file.path("data/test_mixed", "soil_dn_1.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear2, aes(x = drt_treatment, y = soil_moisture_mean)) +
  facet_grid(~fire_class)+
  # Add base data
  geom_violin(aes(fill = drt_treatment), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_1_means_moist, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_1_means_moist,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_material() +
  theme_modern()
ggsave(file.path("data/test_mixed", "moist_dn_1.png"), plot, height = 40, width = 80, units = "cm")


```


 
```{r dn_day_and_night}
# 2. Obtain estimated means
dn_10_means_air <- estimate_means(dn_model_10_air)
dn_10_means_ground <- estimate_means(dn_model_10_ground)
dn_10_means_soil <- estimate_means(dn_model_10_soil)
dn_10_means_moist <- estimate_means(dn_model_10_moist)

dn_11_means_air <- estimate_means(dn_model_11_air)
dn_11_means_ground <- estimate_means(dn_model_11_ground)
dn_11_means_soil <- estimate_means(dn_model_11_soil)
dn_11_means_moist <- estimate_means(dn_model_11_moist)



###############################
#######only day & night########
###############################
plot <- ggplot(micro_linear3, aes(x = dayornight, y = air_temperature_mean)) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_10_means_air, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_10_means_air,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "air_dn_10.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = ground_temperature_mean)) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_10_means_ground, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_10_means_ground,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "ground_dn_10.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = soil_temperature_mean)) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_10_means_soil, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_10_means_soil,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "soil_dn_10.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = soil_moisture_mean)) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_10_means_moist, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_10_means_moist,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "moist_dn_10.png"), plot, height = 40, width = 80, units = "cm")

#############################################
##DAY AND NIGHT ft. DRT TREAT ###############
#########################################

plot <- ggplot(micro_linear3, aes(x = dayornight, y = air_temperature_mean)) +
  facet_wrap(~drt_treatment) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_11_means_air, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_11_means_air,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "air_dn_11.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = ground_temperature_mean)) +
  facet_wrap(~drt_treatment) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_11_means_ground, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_11_means_ground,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "ground_dn_11.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = soil_temperature_mean)) +
  facet_wrap(~drt_treatment) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_11_means_soil, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_11_means_soil,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "soil_dn_11.png"), plot, height = 40, width = 80, units = "cm")

# 3. Plot
plot <- ggplot(micro_linear3, aes(x = dayornight, y = soil_moisture_mean)) +
  # Add base data
  geom_violin(aes(fill = dayornight), color = "white") +
  geom_jitter2(width = 0.05, alpha = 0.5) +

  # Add pointrange and line from means
  geom_line(data = dn_11_means_moist, aes(y = Mean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = dn_11_means_moist,
    aes(y = Mean, ymin = CI_low, ymax = CI_high),
    size = 1,
    color = "white"
  ) +
  # Improve colors
  scale_fill_manual(values = c("day" = "yellow", "night" = "#404040")) +
  theme_modern()
ggsave(file.path("data/test_mixed", "moist_dn_11.png"), plot, height = 40, width = 80, units = "cm")
```



```{r max_min_models_combined}
# Maximum Values
model_air_max <- lmer(air_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_air_max)
anova(model_air_max)
model_air_means_max <- emmeans(object = model_air_max, ~ site|land_type)

gr_max <- ref_grid(model_air_max, cov.keep= c('site', 'land_type'))
emm_max <- emmeans(gr_max, spec= c('site', 'land_type'), level= 0.95)
emm_max
# Minimum Values
model_air_min <- lmer(air_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_air_min)
anova(model_air_min)
model_air_means_min <- emmeans(object = model_air_min, ~ site|land_type)

gr_min <- ref_grid(model_air_min, cov.keep= c('site', 'land_type'))
emm_min <- emmeans(gr_min, spec= c('site', 'land_type'), level= 0.95)
emm_min

# 3. Plot with CL's
plot <- ggplot(data = micro_linear, aes(x = land_type, y = air_temperature_max)) +
  # Add base data for maximum temperatures
  geom_violin(aes(x = land_type, y = air_temperature_max, fill = land_type), color = "white", alpha = 0.75) +
    facet_grid(.~site) +
  geom_jitter2(aes(x = land_type, y = air_temperature_max),width = 0.05, alpha = 0.15, color = 'red') +
  scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  labs(y = "Air Temperature (Celsius)", x = "", fill = "Land Type") +

  # Add pointrange and line from means (maximum temperature)
  geom_line(data = as.data.frame(emm_max), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_max),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "red",
    linewidth = 1.5
  ) +
    # Add pointrange and line from  (minimum temperature)
   geom_violin(aes(x = land_type, y = air_temperature_min, fill = land_type), color = "white", alpha = 0.75) +
    geom_jitter2(aes(x = land_type, y = air_temperature_min),width = 0.05, alpha = 0.15, color = 'blue') +
  geom_line(data = as.data.frame(emm_min), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_min),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "blue",
    linewidth = 1.5
  ) +
  theme_modern()
ggsave(file.path("data/plots/minmax_kasely", "air_min_max.png"), plot, height = 40, width = 80, units = "cm")

################################################"""

# Maximum Values
model_ground_max <- lmer(ground_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_ground_max)
anova(model_ground_max)
model_ground_means_max <- emmeans(object = model_ground_max, ~ site|land_type)

gr_max <- ref_grid(model_ground_max, cov.keep= c('site', 'land_type'))
emm_max <- emmeans(gr_max, spec= c('site', 'land_type'), level= 0.95)
emm_max
# Minimum Values
model_ground_min <- lmer(ground_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_ground_min)
anova(model_ground_min)
model_ground_means_min <- emmeans(object = model_ground_min, ~ site|land_type)

gr_min <- ref_grid(model_ground_min, cov.keep= c('site', 'land_type'))
emm_min <- emmeans(gr_min, spec= c('site', 'land_type'), level= 0.95)
emm_min

# 3. Plot with CL's
plot <- ggplot(data = micro_linear, aes(x = land_type, y = ground_temperature_max)) +
  # Add base data for maximum temperatures
  geom_violin(aes(x = land_type, y = ground_temperature_max, fill = land_type), color = "white", alpha = 0.75) +
    facet_grid(.~site) +
  geom_jitter2(aes(x = land_type, y = ground_temperature_max),width = 0.05, alpha = 0.15, color = 'red') +
  scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  labs(y = "Ground Temperature (Celsius)", x = "", fill = "Land Type") +

  # Add pointrange and line from means (maximum temperature)
  geom_line(data = as.data.frame(emm_max), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_max),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "red",
    linewidth = 1.5
  ) +
    # Add pointrange and line from  (minimum temperature)
   geom_violin(aes(x = land_type, y = ground_temperature_min, fill = land_type), color = "white", alpha = 0.75) +
    geom_jitter2(aes(x = land_type, y = ground_temperature_min),width = 0.05, alpha = 0.15, color = 'blue') +
  geom_line(data = as.data.frame(emm_min), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_min),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "blue",
    linewidth = 1.5
  ) +
  theme_modern()
ggsave(file.path("data/plots/minmax_kasely", "ground_min_max.png"), plot, height = 40, width = 80, units = "cm")

################################################"""

# Maximum Values
model_soil_max <- lmer(soil_temperature_max ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_soil_max)
anova(model_soil_max)
model_soil_means_max <- emmeans(object = model_soil_max, ~ site|land_type)

gr_max <- ref_grid(model_soil_max, cov.keep= c('site', 'land_type'))
emm_max <- emmeans(gr_max, spec= c('site', 'land_type'), level= 0.95)
emm_max
# Minimum Values
model_soil_min <- lmer(soil_temperature_min ~ site*land_type + (1|daytime), data = micro_linear)
summary(model_soil_min)
anova(model_soil_min)
model_soil_means_min <- emmeans(object = model_soil_min, ~ site|land_type)

gr_min <- ref_grid(model_soil_min, cov.keep= c('site', 'land_type'))
emm_min <- emmeans(gr_min, spec= c('site', 'land_type'), level= 0.95)
emm_min

# 3. Plot with CL's
plot <- ggplot(data = micro_linear, aes(x = land_type, y = soil_temperature_max)) +
  # Add base data for maximum temperatures
  geom_violin(aes(x = land_type, y = soil_temperature_max, fill = land_type), color = "white", alpha = 0.75) +
    facet_grid(.~site) +
  geom_jitter2(aes(x = land_type, y = soil_temperature_max),width = 0.05, alpha = 0.15, color = 'red') +
  scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  labs(y = "Soil Temperature (Celsius)", x = "", fill = "Land Type") +

  # Add pointrange and line from means (maximum temperature)
  geom_line(data = as.data.frame(emm_max), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_max),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "red",
    linewidth = 1.5
  ) +
    # Add pointrange and line from  (minimum temperature)
   geom_violin(aes(x = land_type, y = soil_temperature_min, fill = land_type), color = "white", alpha = 0.75) +
    geom_jitter2(aes(x = land_type, y = soil_temperature_min),width = 0.05, alpha = 0.15, color = 'blue') +
  geom_line(data = as.data.frame(emm_min), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_min),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "blue",
    linewidth = 1.5
  ) +
  theme_modern()
ggsave(file.path("data/plots/minmax_kasely", "soil_min_max.png"), plot, height = 40, width = 80, units = "cm")

################################################"""

# Maximum Values
model_moist_max <- lmer(soil_moisture_max ~ site*land_type + (1|loggerID), data = micro_linear)
summary(model_moist_max)
anova(model_moist_max)
model_moist_means_max <- emmeans(object = model_moist_max, ~ site|land_type)

gr_max <- ref_grid(model_moist_max, cov.keep= c('site', 'land_type'))
emm_max <- emmeans(gr_max, spec= c('site', 'land_type'), level= 0.95)
emm_max
# Minimum Values
model_moist_min <- lmer(soil_moisture_min ~ site*land_type + (1|loggerID), data = micro_linear)
summary(model_moist_min)
anova(model_moist_min)
model_moist_means_min <- emmeans(object = model_moist_min, ~ site|land_type)

gr_min <- ref_grid(model_moist_min, cov.keep= c('site', 'land_type'))
emm_min <- emmeans(gr_min, spec= c('site', 'land_type'), level= 0.95)
emm_min

# 3. Plot with CL's
plot <- ggplot(data = micro_linear, aes(x = land_type, y = soil_moisture_max)) +
  # Add base data for maximum temperatures
  geom_violin(aes(x = land_type, y = soil_moisture_max, fill = land_type), color = "white", alpha = 0.75) +
    facet_grid(.~site) +
  geom_jitter2(aes(x = land_type, y = soil_moisture_max),width = 0.05, alpha = 0.15, color = 'red') +
  scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  labs(y = "Soil Moisture (%) )", x = "", fill = "Land Type") +

  # Add pointrange and line from means (maximum temperature)
  geom_line(data = as.data.frame(emm_max), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_max),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "red",
    linewidth = 1.5
  ) +
    # Add pointrange and line from  (minimum temperature)
   geom_violin(aes(x = land_type, y = soil_moisture_min, fill = land_type), color = "white", alpha = 0.75) +
    geom_jitter2(aes(x = land_type, y = soil_moisture_min),width = 0.05, alpha = 0.15, color = 'blue') +
  geom_line(data = as.data.frame(emm_min), aes(y = emmean, group = 1), linewidth = 1) +
  geom_pointrange(
    data = as.data.frame(emm_min),
    aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
    size = 1,
    color = "blue",
    linewidth = 1.5
  ) +
  theme_modern()
ggsave(file.path("data/plots/minmax_kasely", "moist_min_max.png"), plot, height = 40, width = 80, units = "cm")

################################################"""
```




```{r all plots lyseka}
# Load required libraries
emm_options(lmerTest.limit = 10000)
emm_options(pbkrtest.limit = 10000)
###############################################################
# Define temperature metrics to analyze
metrics <- c("air_temperature_mean", "air_temperature_max",
             "air_temperature_min", "air_temperature_range")


# Initialize list to store results
results_DURIN_2 <- list()

# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of site and land types
  model_DURIN_2 <- lmer(as.formula(paste0(metric, " ~ site * land_type + (1|daytime) + (1|species)")), data = micro_linear)
  
  # Generate a summary table of estimated means accounting for the interaction term of site and land type
  summary_table_DURIN_2 <- emmeans(model_DURIN_2,~ site + land_type) %>%
    as_tibble() %>%
    select(site, land_type, emmean, SE, df, lower.CL, upper.CL)
  

  

  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_DURIN_2)
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_summary_table.docx")))
  
  # Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_DURIN_2 <- pairs(emmeans(model_DURIN_2, ~ site*land_type), simple = "each")
  datafram <- data.frame(summary_paired_DURIN_2) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_paired_table.docx")))
  
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_DURIN_2 <- anova(model_DURIN_2)

        
  # Plot the estimated means for each site and land type combination
  p <- ggplot(micro_linear) +
    geom_violin(aes(x = land_type, y = !!sym(metric), fill = land_type), alpha = 0.5) +
    geom_jitter(aes(x = land_type, y = !!sym(metric)), color = "darkgrey", width = 0.2) +
    scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_DURIN_2, aes(x = land_type, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_DURIN_2,
                    aes(x = land_type, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = land_type),
                    size = 1) +
    scale_color_manual(values = c("Forested" = "black",
                                "Open" = "black")) +
    facet_wrap(~ site) +
    labs(title = paste0("Estimated ", metric, " Temperature by Site and Land Type"),
         y = "Temperature (Celsius)",
         color = "Land Type") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
  results_DURIN_2[[metric]] <- list(model = model_DURIN_2,
                                    summary_table = summary_table_DURIN_2, plot = p)
}

#####################################################################################
###############################################################
# Define temperature metrics to analyze
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")


# Initialize list to store results
results_DURIN_2 <- list()

# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of site and land types
  model_DURIN_2 <- lmer(as.formula(paste0(metric, " ~ site * land_type + (1|daytime)+ (1|species)")), data = micro_linear)
  
  # Generate a summary table of estimated means accounting for the interaction term of site and land type
  summary_table_DURIN_2 <- emmeans(model_DURIN_2, ~ site + land_type) %>%
    as_tibble() %>%
    select(site, land_type, emmean, SE, df, lower.CL, upper.CL)

  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_DURIN_2)
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_summary_table.docx")))
  
  # Paired comparisons with significance tests (doesn't yet print to word)
    summary_paired_DURIN_2 <- pairs(emmeans(model_DURIN_2, ~ site*land_type), simple = "each")
  datafram <- data.frame(summary_paired_DURIN_2) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_DURIN_2 <- anova(model_DURIN_2)


        
  # Plot the estimated means for each site and land type combination
  p <- ggplot(micro_linear) +
    geom_violin(aes(x = land_type, y = !!sym(metric), fill = land_type), alpha = 0.5) +
    geom_jitter(aes(x = land_type, y = !!sym(metric)), color = "darkgrey", width = 0.2) +
    scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_DURIN_2, aes(x = land_type, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_DURIN_2,
                    aes(x = land_type, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = land_type),
                    size = 1) +
    scale_color_manual(values = c("Forested" = "black",
                                "Open" = "black")) +
    facet_wrap(~ site) +
    labs(title = paste0("Estimated ", metric, " Temperature by Site and Land Type"),
         y = "Temperature (Celsius)",
         color = "Land Type") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
  results_DURIN_2[[metric]] <- list(model = model_DURIN_2,
                                    summary_table = summary_table_DURIN_2, plot = p)
}

#####################################################################################
###############################################################
# Define temperature metrics to analyze
metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")


# Initialize list to store results
results_DURIN_2 <- list()

# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of site and land types
  model_DURIN_2 <- lmer(as.formula(paste0(metric, " ~ site * land_type + (1|loggerID) + (1|species)")), data = micro_linear)
  
  # Generate a summary table of estimated means accounting for the interaction term of site and land type
  summary_table_DURIN_2 <- emmeans(model_DURIN_2, ~ site + land_type) %>%
    as_tibble() %>%
    select(site, land_type, emmean, SE, df, lower.CL, upper.CL)

  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_DURIN_2)
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_summary_table.docx")))
  
  # Paired comparisons with significance tests (doesn't yet print to word)
   summary_paired_DURIN_2 <- pairs(emmeans(model_DURIN_2, ~ site*land_type), simple = "each")
  datafram <- data.frame(summary_paired_DURIN_2) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_DURIN_2 <- anova(model_DURIN_2)

        
  # Plot the estimated means for each site and land type combination
  p <- ggplot(micro_linear) +
    geom_violin(aes(x = land_type, y = !!sym(metric), fill = land_type), alpha = 0.5) +
    geom_jitter(aes(x = land_type, y = !!sym(metric)), color = "darkgrey", width = 0.2) +
    scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_DURIN_2, aes(x = land_type, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_DURIN_2,
                    aes(x = land_type, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = land_type),
                    size = 1) +
    scale_color_manual(values = c("Forested" = "black",
                                "Open" = "black")) +
    facet_wrap(~ site) +
    labs(title = paste0("Estimated ", metric, " Temperature by Site and Land Type"),
         y = "Temperature (Celsius)",
         color = "Land Type") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
  results_DURIN_2[[metric]] <- list(model = model_DURIN_2,
                                    summary_table = summary_table_DURIN_2, plot = p)
}

#####################################################################################
###############################################################
# Define temperature metrics to analyze
metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


# Initialize list to store results
results_DURIN_2 <- list()

# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of site and land types
  model_DURIN_2 <- lmer(as.formula(paste0(metric, " ~ site * land_type + (1 | loggerID)+(1|species)")), data = micro_linear)
  
  # Generate a summary table of estimated means accounting for the interaction term of site and land type
  summary_table_DURIN_2 <- emmeans(model_DURIN_2, ~ site + land_type) %>%
    as_tibble() %>%
    select(site, land_type, emmean, SE, df, lower.CL, upper.CL)

  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_DURIN_2)
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_summary_table.docx")))
  
  # Paired comparisons with significance tests (doesn't yet print to word)
    summary_paired_DURIN_2 <- pairs(emmeans(model_DURIN_2, ~ site*land_type), simple = "each")
  datafram <- data.frame(summary_paired_DURIN_2) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models",target = paste0(metric, "DURIN_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_DURIN_2 <- anova(model_DURIN_2)

        
  # Plot the estimated means for each site and land type combination
  p <- ggplot(micro_linear) +
    geom_violin(aes(x = land_type, y = !!sym(metric), fill = land_type), alpha = 0.5) +
    geom_jitter(aes(x = land_type, y = !!sym(metric)), color = "darkgrey", width = 0.2) +
    scale_fill_manual(values = c("Forested" = "darkolivegreen4",
                                "Open" = "darkolivegreen2")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_DURIN_2, aes(x = land_type, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_DURIN_2,
                    aes(x = land_type, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = land_type),
                    size = 1) +
    scale_color_manual(values = c("Forested" = "black",
                                "Open" = "black")) +
    facet_wrap(~ site) +
    labs(title = paste0("Estimated ", metric, " Temperature by Site and Land Type"),
         y = "Soil Moisture",
         color = "Land Type") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE TO YOUR PATHWAY!!!! my computer doesn't like relative pathways
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
  results_DURIN_2[[metric]] <- list(model = model_DURIN_2,
                                    summary_table = summary_table_DURIN_2, plot = p)
}

#####################################################################################
```


```{r drought_net_loops_classic}
emm_options(lmerTest.limit = 10000)
emm_options(pbkrtest.limit = 10000)
# Reorder levels for plotting
#re-order factor levels for region
micro_linear2$fire_class <- factor(micro_linear2$fire_class, levels=c('Pioneer', 'Building', 'Mature'))
micro_linear2$drt_treatment <- factor(micro_linear2$drt_treatment, levels=c('0', '50', '90'))

#####################################################################################
# Define temperature metrics to analyze
metrics <- c("air_temperature_mean", "air_temperature_max",
             "air_temperature_min", "air_temperature_range")


# Initialize list to store results
results_DN <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_air_DN <- lmer(as.formula(paste0(metric, " ~ fire_class * drt_treatment + (1 | daytime)")), data = micro_linear2)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_air_DN <- emmeans(model_air_DN, ~ fire_class + drt_treatment) %>%
    as_tibble() %>%
    select(fire_class, drt_treatment, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_air_DN)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_air_DN <- pairs(emmeans(model_air_DN, ~ fire_class*drt_treatment), simple = "each")
  datafram <- data.frame(summary_paired_air_DN) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_air_DN <- anova(model_air_DN)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_linear2) +
    geom_violin(aes(x = drt_treatment, y = !!sym(metric),
                    fill = drt_treatment), alpha = 1) +
    geom_jitter(aes(x = drt_treatment, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("0" = "lightskyblue4",
                                "50" = "lightskyblue3",
                               "90" = "lightskyblue1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_air_DN, aes(x = drt_treatment, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_air_DN,
                    aes(x = drt_treatment, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = drt_treatment),
                    size = 1) +
    scale_color_manual(values = c("0" = "black",
                                "50" = "black",
                                "90" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " Temperature by Fire Class and Drought Treatment"),
         y = "Temperature (Celsius)",
         color = "Drought Treatment") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
  results_DN[[metric]] <- list(model = model_air_DN,
                                    summary_table = summary_table_air_DN, plot = p)
}

# Check if either fire_class or drought treatment has a significant influence on temperature
# summary(results_air_DN[["mean"]][["model"]])$coefficients
#################################################################################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")


# Initialize list to store results
results_DN <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_ground_DN <- lmer(as.formula(paste0(metric, " ~ fire_class * drt_treatment + (1 | daytime)")), data = micro_linear2)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_ground_DN <- emmeans(model_ground_DN, ~ fire_class + drt_treatment) %>%
    as_tibble() %>%
    select(fire_class, drt_treatment, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_ground_DN)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_ground_DN <- pairs(emmeans(model_ground_DN, ~ fire_class*drt_treatment), simple = "each")
   datafram <- data.frame(summary_paired_ground_DN) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_ground_DN <- anova(model_ground_DN)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_linear2) +
    geom_violin(aes(x = drt_treatment, y = !!sym(metric),
                    fill = drt_treatment), alpha = 1) +
    geom_jitter(aes(x = drt_treatment, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("0" = "lightskyblue4",
                                "50" = "lightskyblue3",
                               "90" = "lightskyblue1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_ground_DN, aes(x = drt_treatment, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_ground_DN,
                    aes(x = drt_treatment, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = drt_treatment),
                    size = 1) +
    scale_color_manual(values = c("0" = "black",
                                "50" = "black",
                                "90" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " Temperature by Fire Class and Drought Treatment"),
         y = "Temperature (Celsius)",
         color = "Drought Treatment") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
}

# Check if either fire_class or drought treatment has a significant influence on temperature
 #summary(results_air_DN[["mean"]][["model"]])$coefficients

#################################################################################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")


# Initialize list to store results
results_DN <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_soil_DN <- lmer(as.formula(paste0(metric, " ~ fire_class * drt_treatment + (1 | daytime)")), data = micro_linear2)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_soil_DN <- emmeans(model_soil_DN, ~ fire_class + drt_treatment) %>%
    as_tibble() %>%
    select(fire_class, drt_treatment, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_soil_DN)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_soil_DN <- pairs(emmeans(model_soil_DN, ~ fire_class*drt_treatment), simple = "each")
   datafram <- data.frame(summary_paired_soil_DN) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_soil_DN <- anova(model_soil_DN)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_linear2) +
    geom_violin(aes(x = drt_treatment, y = !!sym(metric),
                    fill = drt_treatment), alpha = 1) +
    geom_jitter(aes(x = drt_treatment, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("0" = "lightskyblue4",
                                "50" = "lightskyblue3",
                               "90" = "lightskyblue1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_soil_DN, aes(x = drt_treatment, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_soil_DN,
                    aes(x = drt_treatment, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = drt_treatment),
                    size = 1) +
    scale_color_manual(values = c("0" = "black",
                                "50" = "black",
                                "90" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " Temperature by Fire Class and Drought Treatment"),
         y = "Temperature (Celsius)",
         color = "Drought Treatment") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
 
}

# Check if either fire_class or drought treatment has a significant influence on temperature
# summary(results_air_DN[["mean"]][["model"]])$coefficients
#################################################################################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


# Initialize list to store results
results_DN <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_moist_DN <- lmer(as.formula(paste0(metric, " ~ fire_class * drt_treatment + (1 | loggerID)")), data = micro_linear2)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_moist_DN <- emmeans(model_moist_DN, ~ fire_class + drt_treatment) %>%
    as_tibble() %>%
    select(fire_class, drt_treatment, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_moist_DN)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_moist_DN <- pairs(emmeans(model_moist_DN, ~ fire_class*drt_treatment), simple = "each")
   datafram <- data.frame(summary_paired_moist_DN) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", target = paste0(metric, "DroughtNet_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_moist_DN <- anova(model_moist_DN)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_linear2) +
    geom_violin(aes(x = drt_treatment, y = !!sym(metric),
                    fill = drt_treatment), alpha = 1) +
    geom_jitter(aes(x = drt_treatment, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("0" = "lightskyblue4",
                                "50" = "lightskyblue3",
                               "90" = "lightskyblue1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_moist_DN, aes(x = drt_treatment, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_moist_DN,
                    aes(x = drt_treatment, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = drt_treatment),
                    size = 1) +
    scale_color_manual(values = c("0" = "black",
                                "50" = "black",
                                "90" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, "Soil Moisture by Fire Class and Drought Treatment"),
         y = "Moisture",
         color = "Drought Treatment") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/firedrt", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
  # Store results in list
 
}

# Check if either fire_class or drought treatment has a significant influence on temperature
# summary(results_air_DN[["mean"]][["model"]])$coefficients
#################################################################################################################
```

```{r control vs 0% drt}
emm_options(lmerTest.limit = 10000)
emm_options(pbkrtest.limit = 10000)
micro_control <- micro_data2 %>%
  filter(drt_treatment == "0" | species =="Control") %>%
  mutate(species2 = ifelse(species == "Control","Control","Shrubs"))
micro_control$fire_class <- factor(micro_control$fire_class, levels=c('Pioneer', 'Building', 'Mature'))

#####################################################################################
# Define temperature metrics to analyze
metrics <- c("air_temperature_mean", "air_temperature_max",
             "air_temperature_min", "air_temperature_range")


# Initialize list to store results
results_air_control <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_air_control <- lmer(as.formula(paste0(metric, " ~ fire_class * species2 + (1 | daytime)")), data = micro_control)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_air_control <- emmeans(model_air_control, ~ fire_class + species2) %>%
    as_tibble() %>%
    select(fire_class, species2, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_air_control)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "DroughtNet_Control_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_air_control <- pairs(emmeans(model_air_control, ~ fire_class*species2), simple = "each")
  datafram <- data.frame(summary_paired_air_control) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "Control_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_air_control <- anova(model_air_control)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_control) +
    geom_violin(aes(x = species2, y = !!sym(metric),
                    fill = species2), alpha = 1) +
    geom_jitter(aes(x = species2, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("Shrubs" = "lightgreen",
                                "Control" = "brown")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_air_control, aes(x = species2, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_air_control,
                    aes(x = species2, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = species2),
                    size = 1) +
    scale_color_manual(values = c("Shrubs" = "black",
                                "Control" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " Temperature by Fire Class Shrubs vs Control"),
         y = "Temperature (Celsius)",
         color = "Shrubs or Control") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}
####################################################
####################################################
# Define temperature metrics to analyze
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")


# Initialize list to store results
results_ground_control <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_ground_control <- lmer(as.formula(paste0(metric, " ~ fire_class * species2 + (1 | daytime)")), data = micro_control)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_ground_control <- emmeans(model_ground_control, ~ fire_class + species2) %>%
    as_tibble() %>%
    select(fire_class, species2, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_ground_control)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "DroughtNet_Control_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_ground_control <- pairs(emmeans(model_ground_control, ~ fire_class*species2), simple = "each")
   datafram <- data.frame(summary_paired_ground_control) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "Control_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_ground_control <- anova(model_ground_control)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_control) +
    geom_violin(aes(x = species2, y = !!sym(metric),
                    fill = species2), alpha = 1) +
    geom_jitter(aes(x = species2, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("Shrubs" = "lightgreen",
                                "Control" = "brown")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_ground_control, aes(x = species2, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_ground_control,
                    aes(x = species2, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = species2),
                    size = 1) +
    scale_color_manual(values = c("Shrubs" = "black",
                                "Control" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " Temperature by Fire Class Shrubs vs Control"),
         y = "Temperature (Celsius)",
         color = "Shrubs or Control") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}

####################################################
# Define temperature metrics to analyze
metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")


# Initialize list to store results
results_soil_control <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_soil_control <- lmer(as.formula(paste0(metric, " ~ fire_class * species2 + (1 | daytime)")), data = micro_control)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_soil_control <- emmeans(model_soil_control, ~ fire_class + species2) %>%
    as_tibble() %>%
    select(fire_class, species2, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_soil_control)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "DroughtNet_Control_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_soil_control <- pairs(emmeans(model_soil_control, ~ fire_class*species2), simple = "each")
   datafram <- data.frame(summary_paired_soil_control) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "Control_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_soil_control <- anova(model_soil_control)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_control) +
    geom_violin(aes(x = species2, y = !!sym(metric),
                    fill = species2), alpha = 1) +
    geom_jitter(aes(x = species2, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("Shrubs" = "lightgreen",
                                "Control" = "brown")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_soil_control, aes(x = species2, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_soil_control,
                    aes(x = species2, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = species2),
                    size = 1) +
    scale_color_manual(values = c("Shrubs" = "black",
                                "Control" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " by Fire Class Shrubs vs Control"),
         y = "Temperature (Celsius)",
         color = "Shrubs or Control") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}

####################################################
# Define temperature metrics to analyze
metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


# Initialize list to store results
results_moist_control <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_moist_control <- lmer(as.formula(paste0(metric, " ~ fire_class * species2 + (1 | loggerID)")), data = micro_control)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_moist_control <- emmeans(model_moist_control, ~ fire_class + species2) %>%
    as_tibble() %>%
    select(fire_class, species2, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_moist_control)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "DroughtNet_Control_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_moist_control <- pairs(emmeans(model_moist_control, ~ fire_class*species2), simple = "each")
   datafram <- data.frame(summary_paired_moist_control) %>%
  mutate(p.value = as.numeric(p.value),   # Convertir en type numérique
         p.value = ifelse(p.value <= 0.001, 0.001, round(p.value,3)))
         # Arrondir vers le haut à 3 décimales

  doc <- read_docx()
  doc <- body_add_table(
    doc, datafram
  )
    print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", target = paste0(metric, "Control_paired_table.docx")))
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_moist_control <- anova(model_moist_control)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_control) +
    geom_violin(aes(x = species2, y = !!sym(metric),
                    fill = species2), alpha = 1) +
    geom_jitter(aes(x = species2, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("Shrubs" = "lightgreen",
                                "Control" = "brown")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_moist_control, aes(x = species2, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_moist_control,
                    aes(x = species2, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = species2),
                    size = 1) +
    scale_color_manual(values = c("Shrubs" = "black",
                                "Control" = "black")) +
    facet_wrap(~ fire_class) +
    labs(title = paste0("Estimated ", metric, " by Fire Class Shrubs vs Control"),
         y = "Moisture",
         color = "Shrubs or Control") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/control", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}

####################################################
```

```{r model_day_and_night}
micro_day <- micro_data3 %>%
  filter(species !="Control")
micro_day$fire_class <- factor(micro_day$fire_class, levels=c('Pioneer', 'Building', 'Mature'))
micro_day$drt_treatment <- factor(micro_day$drt_treatment, levels=c('0', '50', '90'))

#####################################################################################
# Define temperature metrics to analyze
metrics <- c("air_temperature_mean", "air_temperature_max",
             "air_temperature_min", "air_temperature_range")


# Initialize list to store results
results_air_day <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_air_day <- lmer(as.formula(paste0(metric, " ~ drt_treatment * dayornight * fire_class + (1 | daytime)")), data = micro_day)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_air_day <- emmeans(model_air_day, ~ drt_treatment + dayornight) %>%
    as_tibble() %>%
    select(drt_treatment, dayornight, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_air_day)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", target = paste0(metric, "DroughtNet_dayornight_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_air_day <- pairs(emmeans(model_air_day, ~ drt_treatment*dayornight), simple = "each")
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_air_day <- anova(model_air_day)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_day) +
    geom_violin(aes(x = dayornight, y = !!sym(metric),
                    fill = dayornight), alpha = 1) +
    geom_jitter(aes(x = dayornight, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("night" = "blue4",
                                "day" = "darkgoldenrod1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_air_day, aes(x = dayornight, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_air_day,
                    aes(x = dayornight, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = dayornight),
                    size = 1) +
    scale_color_manual(values = c("night" = "black",
                                "day" = "black")) +
    facet_wrap(~ drt_treatment) +
    labs(title = paste0("Estimated ", metric, " Temperature by Treatment Night vs Day"),
         y = "Temperature (Celsius)",
         color = "Day or Night") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}
####################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")


# Initialize list to store results
results_ground_day <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_ground_day <- lmer(as.formula(paste0(metric, " ~ drt_treatment * dayornight * fire_class + (1 | daytime)")), data = micro_day)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_ground_day <- emmeans(model_ground_day, ~ drt_treatment + dayornight) %>%
    as_tibble() %>%
    select(drt_treatment, dayornight, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_ground_day)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", target = paste0(metric, "DroughtNet_dayornight_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_ground_day <- pairs(emmeans(model_ground_day, ~ drt_treatment*dayornight), simple = "each")
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_ground_day <- anova(model_ground_day)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_day) +
    geom_violin(aes(x = dayornight, y = !!sym(metric),
                    fill = dayornight), alpha = 1) +
    geom_jitter(aes(x = dayornight, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("night" = "blue4",
                                "day" = "darkgoldenrod1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_ground_day, aes(x = dayornight, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_ground_day,
                    aes(x = dayornight, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = dayornight),
                    size = 1) +
    scale_color_manual(values = c("night" = "black",
                                "day" = "black")) +
    facet_wrap(~ drt_treatment) +
    labs(title = paste0("Estimated ", metric, " Temperature by Treatment Night vs Day"),
         y = "Temperature (Celsius)",
         color = "Day or Night") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}
####################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")


# Initialize list to store results
results_soil_day <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_soil_day <- lmer(as.formula(paste0(metric, " ~ drt_treatment * dayornight * fire_class+ (1 | daytime)")), data = micro_day)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_soil_day <- emmeans(model_soil_day, ~ drt_treatment + dayornight) %>%
    as_tibble() %>%
    select(drt_treatment, dayornight, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_soil_day)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", target = paste0(metric, "DroughtNet_dayornight_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_soil_day <- pairs(emmeans(model_soil_day, ~ drt_treatment*dayornight), simple = "each")
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_soil_day <- anova(model_soil_day)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_day) +
    geom_violin(aes(x = dayornight, y = !!sym(metric),
                    fill = dayornight), alpha = 1) +
    geom_jitter(aes(x = dayornight, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("night" = "blue4",
                                "day" = "darkgoldenrod1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_soil_day, aes(x = dayornight, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_soil_day,
                    aes(x = dayornight, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = dayornight),
                    size = 1) +
    scale_color_manual(values = c("night" = "black",
                                "day" = "black")) +
    facet_wrap(~ drt_treatment) +
    labs(title = paste0("Estimated ", metric, " Temperature by Treatment Night vs Day"),
         y = "Temperature (Celsius)",
         color = "Day or Night") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}
####################################################
#####################################################################################
# Define temperature metrics to analyze
metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


# Initialize list to store results
results_moist_day <- list()


# Loop over temperature metrics
for (metric in metrics) {
  # Fit a linear mixed model to assess how the temperature metric varies depending on the interaction of fire_class and land types
  model_moist_day <- lmer(as.formula(paste0(metric, " ~ drt_treatment * dayornight * fire_class + (1 | loggerID)")), data = micro_day)
  
  # Generate a summary table of estimated means accounting for the interaction term of fire_class and land type
  summary_table_moist_day <- emmeans(model_moist_day, ~ drt_treatment + dayornight) %>%
    as_tibble() %>%
    select(drt_treatment, dayornight, emmean, SE, df, lower.CL, upper.CL)
  
  # Export summary table to Word document
  doc <- read_docx()
  doc <- body_add_table(doc, summary_table_moist_day)
# CHANGE YOUR PATHWAY!!!
  print(doc, file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", target = paste0(metric, "DroughtNet_dayornight_summary_table.docx")))
  
# Paired comparisons with significance tests (doesn't yet print to word)
  summary_paired_moist_day <- pairs(emmeans(model_moist_day, ~ drt_treatment*dayornight), simple = "each")
# SUmmary anova for the model, i.e. is site, or land type or interaction significant over all. Then use the paired approach above to figure out differences.
  summary_anova_moist_day <- anova(model_moist_day)

  # Plot the estimated means for each fire_class and drought treatment combination
  p <- ggplot(micro_day) +
    geom_violin(aes(x = dayornight, y = !!sym(metric),
                    fill = dayornight), alpha = 1) +
    geom_jitter(aes(x = dayornight, y = !!sym(metric),
                color = "black"), width = 0.1, alpha = 0.23) +
    scale_fill_manual(values = c("night" = "blue4",
                                "day" = "darkgoldenrod1")) +
  # Add the estimated means data over the raw datasets as points with error bars connected
    geom_line(data = summary_table_moist_day, aes(x = dayornight, y = emmean, group = 1),
              linewidth = 1) +
    geom_pointrange(data = summary_table_moist_day,
                    aes(x = dayornight, y = emmean,
                        ymin = lower.CL,
                        ymax = upper.CL,
                        color = dayornight),
                    size = 1) +
    scale_color_manual(values = c("night" = "black",
                                "day" = "black")) +
    facet_wrap(~ drt_treatment) +
    labs(title = paste0("Estimated ", metric, " Moisture by Treatment Night vs Day"),
         y = "Soil Moisture",
         color = "Day or Night") +
    theme_modern()
  
  # Save the plot as an .jpeg file
# CHANGE YOUR PATHWAY!!!
  ggsave(file.path("D:/Cours/DURIN/Code/Durin_data/data/plots/Models/drought_net/day", paste0(metric, "_temperature_plot_summary.jpeg")), plot = p)
  
}
####################################################



```

```{r anova model contorl shrub}
#### fire_class + drought_net
# Example of fixed effects comparisons, with same random effects structure
##
  dn_model_1_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|loggerID), data = micro_control)
  
  dn_model_1a_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|daytime), data = micro_control)
  summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)
  
  dn_model_1c_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|species), data = micro_control)
  
  dn_model_1s_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)
  
  dn_model_1as_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)
  
  dn_model_1bs_air <- lmer(air_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)

##
  ##
  dn_model_1_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|loggerID), data = micro_control)
  
  dn_model_1a_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|daytime), data = micro_control)
    summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)
  
  dn_model_1c_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|species), data = micro_control)
  
  dn_model_1s_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)
  
  dn_model_1as_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)
  
  dn_model_1bs_air <- lmer(air_temperature_max ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)

##
  dn_model_1_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|loggerID), data = micro_control)
  
  dn_model_1a_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|daytime), data = micro_control)
    summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)
  
  dn_model_1c_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|species), data = micro_control)
  
  dn_model_1s_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)
  
  dn_model_1as_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)
  
  dn_model_1bs_air <- lmer(air_temperature_min ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)


##
dn_model_1_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|loggerID), data = micro_control)
  
  dn_model_1a_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|daytime), data = micro_control)
      summary(dn_model_1a_air)
  anova(dn_model_1a_air)
  dn_model_1b_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)
  
  dn_model_1c_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|species), data = micro_control)
  
  dn_model_1s_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)
  
  dn_model_1as_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)
  
  dn_model_1bs_air <- lmer(air_temperature_range ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
    
  anova(dn_model_1_air,dn_model_1a_air,dn_model_1b_air,dn_model_1c_air,dn_model_1as_air,dn_model_1bs_air,dn_model_1s_air)
  
  
metrics <- c("ground_temperature_mean", "ground_temperature_max",
             "ground_temperature_min", "ground_temperature_range")

########
dn_model_1_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)

dn_model_1b_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_ground <- lmer(ground_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)


dn_model_1b_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_ground <- lmer(ground_temperature_max ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)


dn_model_1b_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_ground <- lmer(ground_temperature_min ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##
########
dn_model_1_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_ground)
  anova(dn_model_1a_ground)

dn_model_1b_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_ground <- lmer(ground_temperature_range ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_ground,dn_model_1s_ground,dn_model_1a_ground,dn_model_1as_ground,dn_model_1b_ground,dn_model_1bs_ground,dn_model_1c_ground)

##






###

metrics <- c("soil_temperature_mean", "soil_temperature_max",
             "soil_temperature_min", "soil_temperature_range")



##  
dn_model_1_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_soil <- lmer(soil_temperature_mean ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)


dn_model_1b_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_soil <- lmer(soil_temperature_max ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_soil <- lmer(soil_temperature_min ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##
##  
dn_model_1_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|loggerID), data = micro_control)

dn_model_1a_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|daytime), data = micro_control)
     summary(dn_model_1a_soil)
  anova(dn_model_1a_soil)

dn_model_1b_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_soil <- lmer(soil_temperature_range ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_soil,dn_model_1s_soil,dn_model_1a_soil,dn_model_1as_soil,dn_model_1b_soil,dn_model_1bs_soil,dn_model_1c_soil)

##




#############################################################################################

metrics <- c("soil_moisture_mean", "soil_moisture_max",
             "soil_moisture_min", "soil_moisture_range")


###  
dn_model_1_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|loggerID), data = micro_control)
     summary(dn_model_1_moist)
  anova(dn_model_1_moist)
  
dn_model_1a_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|daytime), data = micro_control)


dn_model_1b_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_moist <- lmer(soil_moisture_mean ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|loggerID), data = micro_control)
     summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|daytime), data = micro_control)


dn_model_1b_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_moist <- lmer(soil_moisture_max ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data =micro_control) 
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|loggerID), data = micro_control)
     summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|daytime), data = micro_control)


dn_model_1b_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_moist <- lmer(soil_moisture_min ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data =micro_control) 
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###
###  
dn_model_1_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|loggerID), data = micro_control)
     summary(dn_model_1_moist)
  anova(dn_model_1_moist)
dn_model_1a_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|daytime), data = micro_control)


dn_model_1b_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|plotID/loggerID), data = micro_control)


dn_model_1c_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|species), data = micro_control)

dn_model_1s_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|loggerID)+ (1|species), data = micro_control)


dn_model_1as_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|daytime) + (1|species), data = micro_control)


dn_model_1bs_moist <- lmer(soil_moisture_range ~ fire_class*species2 + (1|plotID/loggerID) + (1|species), data = micro_control)
                              
anova(dn_model_1_moist,dn_model_1s_moist,dn_model_1a_moist,dn_model_1as_moist,dn_model_1b_moist,dn_model_1bs_moist,dn_model_1c_moist)
###

```

```{r tets plots}
# Fit a linear mixed effects model
model_test <- lmer(air_temperature_mean ~ site * land_type + (1|daytime) + (1|species), data = micro_linear)

# Obtain the emmeans object
emm <- emmeans(model_test, ~ site * land_type)

# Obtain compact letter displays
cld_table <- cld(emm)

# Add the compact letter displays to the data
data$cld <- cld_table[match(paste(micro_linear$site, micro_linear$land_type), rownames(cld_table))]

# Plot the data using ggplot
ggplot(data, aes(x = site, y = air_temperature_mean, fill = land_type)) +
  geom_boxplot() +
  geom_text(aes(label = cld), position = position_dodge(width = 0.75), vjust = -0.5)
```

